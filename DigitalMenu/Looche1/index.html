<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>کافه تیالی — منوی موبایل</title>

  <!-- Vazir Font -->
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet" type="text/css" />

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

  <style>
    :root{
      /* پالت برند تیالی */
      --brand-green: #104322;  /* اصلی */
      --brand-olive: #8D916A;  /* مکمل */
      --brand-brown: #4E2916;  /* قهوه‌ای */
      --bg: #0f0e0d;
      --surface: #161514;
      --ink: #F2EFEA;
      --muted: #CFC7B9;
      --chip: #1E1C1A;
      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --radius: 16px;
    }

    *{ box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height:100%; }
    body{
      margin:0;
      font-family: Vazir, Tahoma, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: linear-gradient(180deg, #0f0e0d, #151311);
      color: var(--ink);
    }

    /* --- Mobile-first layout --- */
    .app{
      max-width: 520px;
      margin: 0 auto;
      min-height: 100dvh;
      display: grid;
      grid-template-rows: auto auto 1fr auto;
      gap: 10px;
      padding: 10px;
      padding-right: 86px; /* جا برای ستون دسته‌ها سمت راست */
    }

    /* Header with logo */
    .header{
      display:flex; align-items:center; gap:10px;
    }
    .logo{
      width:44px; height:44px; border-radius:12px; overflow:hidden;
      display:grid; place-items:center; background: var(--brand-brown);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.1);
    }
    .logo img{ width:100%; height:100%; object-fit: cover; display:block; }
    .brand-block{ display:flex; flex-direction:column; line-height:1.2; }
    .brand-name{ font-weight:900; font-size:18px; }
    .brand-sub{ font-size:12px; color: var(--muted) }

    /* Search */
    .search{
      display:flex; align-items:center; gap:8px;
      background: var(--surface);
      border:1px solid rgba(255,255,255,.08);
      border-radius: 999px;
      padding:10px 12px;
      box-shadow: var(--shadow);
    }
    .search i{ color: var(--brand-olive) }
    .search input{
      flex:1; border:none; outline:none; background:transparent; color:var(--ink);
      font-size:14px;
    }

    /* Category chips column (RIGHT) */
    .cats{
      position: fixed;
      right: 8px;
      top: 110px;             /* زیر هدر و جستجو */
      bottom: 86px;           /* بالای دکمه سبد خرید */
      width: 68px;
      display:flex; flex-direction: column; gap:8px;
      overflow:auto;
      z-index: 35;
    }
    .chip{
      flex:0 0 auto;
      padding:8px 6px;
      background: var(--chip);
      border: 1px solid rgba(255,255,255,.08);
      color: var(--ink);
      border-radius: 12px;
      display:flex; flex-direction: column; align-items:center; justify-content:center; gap:6px;
      text-align:center;
    }
    .chip i{ color: var(--brand-olive); width:18px; text-align:center; font-size:14px }
    .chip span{ font-size:10px; line-height:1.2 }
    .chip.active{
      background: color-mix(in oklab, var(--brand-green) 28%, #1B1A19);
      border-color: color-mix(in oklab, var(--brand-green) 50%, #ffffff 50%);
      box-shadow: 0 0 0 2px rgba(16,67,34,.25) inset;
    }

    /* Menu grid: single column on mobile */
    .grid{
      display:grid; grid-template-columns: 1fr; gap:10px;
    }

    /* Card */
    .card{
      background: var(--surface);
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      overflow:hidden; box-shadow: var(--shadow);
      transform: translateY(8px); opacity:.0; animation: up .45s ease forwards;
    }
    @keyframes up { to { transform:none; opacity:1; } }

    /* Vertical image: 3:4 with fallback height */
    .card-media{
      width:100%; aspect-ratio: 3 / 4; height:auto; object-fit:cover; background:#2a2623; display:block;
    }
    @supports not (aspect-ratio: 1){
      .card-media{ height: 320px; }
    }

    .card-body{ padding:10px 12px; }
    .item-name{ font-weight:900; font-size:15px; text-align:center }
    .item-desc{ color:#cbbfae; font-size:12px; line-height:1.7; margin-top:6px; text-align:center }
    .buy-row{
      margin-top:10px;
      display:flex; align-items:center; justify-content: center; gap:10px;
    }
    .price{ color: var(--brand-olive); font-weight:900; }
    .add{
      padding:8px 12px; border-radius: 12px; border:1px solid rgba(255,255,255,.14);
      background: color-mix(in oklab, var(--brand-green) 12%, rgba(255,255,255,.08));
      color:#fff; display:inline-flex; align-items:center; gap:6px; cursor:pointer;
    }
    .add i{ font-size:12px }

    /* Floating Cart Button */
    .fab{
      position: fixed;
      left: 14px;
      bottom: 14px;
      width: 58px; height: 58px; border-radius: 16px;
      background: radial-gradient(120px 120px at 30% 20%, var(--brand-olive), var(--brand-green));
      color: #fff; display:grid; place-items:center; border:none; cursor:pointer;
      box-shadow: 0 12px 24px rgba(0,0,0,.45);
      z-index: 40;
    }
    .badge{
      position:absolute; top:-6px; right:-6px;
      width:22px; height:22px; border-radius:999px; background:#ff4757; color:#fff;
      display:grid; place-items:center; font-size:12px; font-weight:900;
      border:2px solid #0e0d0c;
    }

    /* Cart overlay: fully hidden when closed */
    .overlay{
      position: fixed; inset: 0;
      background: rgba(0,0,0,.6);
      display: none;          /* HIDDEN when closed */
      z-index: 50;
      align-items: flex-end;  /* bottom sheet */
    }
    .overlay.open{ display:flex; }

    .sheet{
      width: 100%;
      background: #121110;
      border-top-left-radius: 18px;
      border-top-right-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 -12px 24px rgba(0,0,0,.45);
      max-height: 82dvh;
      display:flex; flex-direction:column;
      animation: slideUp .25s ease;
    }
    @keyframes slideUp{ from { transform: translateY(20px); opacity:.0 } to { transform:none; opacity:1 } }

    .sheet-head{
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px 14px; border-bottom:1px dashed rgba(255,255,255,.16);
    }
    .sheet-title{ font-weight:900; color: var(--brand-olive) }
    .sheet-close{ background:none; border:none; color:#fff; font-size:20px; cursor:pointer }

    .sheet-body{ padding: 10px 12px; overflow:auto; flex:1 }
    .row{ display:flex; gap:10px; align-items:center; padding:10px 0; border-bottom:1px dashed rgba(255,255,255,.12) }
    .thumb{ width:54px; height:54px; border-radius:10px; object-fit:cover; background:#2a2623 }
    .rn{ font-size:14px; font-weight:800 }
    .rp{ color:var(--brand-olive); font-weight:900; font-size:12px }
    .qty{ margin-inline-start:auto; display:flex; align-items:center; gap:8px }
    .qbtn{ width:28px; height:28px; border-radius:10px; border:1px solid rgba(255,255,255,.16);
           background:rgba(255,255,255,.08); color:#fff; }

    .sheet-foot{ padding: 12px 14px; border-top:1px dashed rgba(255,255,255,.16) }
    .total{ display:flex; justify-content:space-between; font-weight:900; color: var(--brand-olive) }

    /* Image modal */
    .modal{
      position:fixed; inset:0; background:rgba(0,0,0,.85); display:none; align-items:center; justify-content:center; z-index:60;
    }
    .modal.open{ display:flex }
    .modal img{ max-width:92vw; max-height:92vh; border-radius:14px; background:#222 }

    /* Larger screens improvements */
    @media (min-width: 640px){
      .app{ padding: 16px; gap: 12px; }
      .grid{ grid-template-columns: repeat(2, 1fr); }
      .sheet{ max-width: 520px; margin: 0 auto; }
    }
    @media (min-width: 900px){
      .grid{ grid-template-columns: repeat(3, 1fr); }
    }
  </style>

  <style id="lucche-theme-override">
    /* brand override (Cafe Lucche) */
    body{
      background:
        radial-gradient(900px 600px at 85% -10%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(600px 500px at -10% 100%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(135deg, #1A2672, #1F2F87) !important;
      color: #fff;
    }
    .header, .search, .cats .chip, .card, .sheet, .modal, .overlay .sheet, .brand-block, .grid{
      background: rgba(255,255,255,.06) !important;
      border: 1px solid rgba(255,255,255,.12) !important;
      backdrop-filter: blur(8px) saturate(140%) !important;
      -webkit-backdrop-filter: blur(8px) saturate(140%) !important;
    }
    .brand-name, .brand-sub, .price, .item-name, .item-desc{ color:#fff !important; }
    .qbtn, .badge { color:#fff !important; border-color: rgba(255,255,255,.2) !important; }
    .cats .chip.active{ box-shadow: 0 0 0 3px rgba(26,38,114,.35) !important; }
    a { color: #e9f0ff; }
  </style>
</head>
<body>
  <div class="app">
    <!-- header -->
    <header class="header">
      <div class="logo">
        <img src="logo.jpg" alt="لوگوی تیالی" onerror="this.replaceWith(Object.assign(document.createElement('div'),{textContent:'TY',style:'font-weight:900;color:#fff'}))">
      </div>
      <div class="brand-block">
        <div class="brand-name">کافه تیالی</div>
        <div class="brand-sub">منوی ویژه</div>
      </div>
    </header>

    <!-- search -->
    <div class="search">
      <i class="fa fa-magnifying-glass"></i>
      <input id="search" placeholder="جستجو در منو (مثلاً لته، موکا، توت‌فرنگی)" />
    </div>

    <!-- categories column on the right -->
    <nav class="cats" id="cats"></nav>

    <!-- grid -->
    <main class="grid" id="grid"></main>
  </div>

  <!-- Floating Cart -->
  <button class="fab" id="fab" aria-label="سبد خرید">
    <i class="fa-solid fa-bag-shopping"></i>
    <span class="badge" id="badge">0</span>
  </button>

  <!-- Cart Bottom Sheet Overlay (hidden when closed) -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="sheetTitle">
    <section class="sheet">
      <div class="sheet-head">
        <div id="sheetTitle" class="sheet-title">سبد خرید</div>
        <button class="sheet-close" id="closeSheet" aria-label="بستن">&times;</button>
      </div>
      <div class="sheet-body" id="cartItems"></div>
      <div class="sheet-foot">
        <div class="total">
          <span>جمع کل</span>
          <span id="cartTotal">۰ تومان</span>
        </div>
      </div>
    </section>
  </div>

  <!-- Image Modal -->
  <div class="modal" id="modal"><img id="modalImg" alt=""/></div>

  <script>
    (function(){ if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', boot); } else { boot(); } })();

    function boot(){
      try{ init(); }catch(e){ console.error(e); alert('خطا در بارگذاری: '+e.message); }
    }

    function init(){
      const data = getMenuData();
      const cats = Object.keys(data);

      const catsEl = document.getElementById('cats');
      const gridEl = document.getElementById('grid');
      const searchEl = document.getElementById('search');

      const fab = document.getElementById('fab');
      const badge = document.getElementById('badge');
      const overlay = document.getElementById('overlay');
      const closeSheet = document.getElementById('closeSheet');
      const cartItems = document.getElementById('cartItems');
      const cartTotal = document.getElementById('cartTotal');

      const modal = document.getElementById('modal');
      const modalImg = document.getElementById('modalImg');

      // Build category chips (RIGHT column). Default = شیک‌ها
      const icons = getIcons();
      const defaultCat = cats.includes('شیک‌ها') ? 'شیک‌ها' : cats[0];
      cats.forEach((c) => {
        const el = document.createElement('button');
        el.className = 'chip' + (c===defaultCat ? ' active' : '');
        el.dataset.cat = c;
        el.innerHTML = '<i class="fa-solid '+(icons[c]||'fa-circle')+'"></i><span>'+c+'</span>';
        el.addEventListener('click', () => selectCategory(c, el));
        catsEl.appendChild(el);
      });

      // Render cards
      function card(item, delay){
        const desc = item.description ? '<div class="item-desc">'+item.description+'</div>' : '';
        return (
          '<article class="card" style="animation-delay:'+delay+'s">'+
              '<img src="'+item.image+'" alt="'+item.name+'" class="card-media" data-zoom="'+item.image+'"/>'+
              '<div class="card-body">'+
                '<div class="item-name">'+item.name+'</div>'+
                 desc +
                '<div class="buy-row">'+
                  '<div class="price">'+item.price+'</div>'+
                  '<button class="add" aria-label="افزودن" data-name="'+esc(item.name)+'" data-price="'+esc(item.price)+'" data-image="'+esc(item.image)+'">'+
                    '<i class="fa-solid fa-plus"></i><span>افزودن</span>'+
                  '</button>'+
                '</div>'+
              '</div>'+
          '</article>'
        );
      }
      function esc(v){ return String(v).replace(/"/g,'&quot;'); }

      function render(cat, filter=''){
        gridEl.innerHTML = '';
        const items = data[cat].items;
        const q = filter.trim().toLowerCase();
        let n=0;
        items.forEach(it => {
          const hay = (it.name + ' ' + (it.description||'')).toLowerCase();
          if(!q || hay.includes(q)){
            gridEl.insertAdjacentHTML('beforeend', card(it, n*0.06));
            n++;
          }
        });

        // Image zoom
        gridEl.querySelectorAll('[data-zoom]').forEach(img => {
          img.addEventListener('click', () => {
            modalImg.src = img.getAttribute('data-zoom');
            modal.classList.add('open');
          });
        });
        // Add to cart
        gridEl.querySelectorAll('.add').forEach(btn => {
          btn.addEventListener('click', () => {
            addToCart({
              name: btn.getAttribute('data-name'),
              price: btn.getAttribute('data-price'),
              image: btn.getAttribute('data-image')
            });
          });
        });
      }

      function selectCategory(cat, el){
        catsEl.querySelectorAll('.chip').forEach(x => x.classList.remove('active'));
        el.classList.add('active');
        render(cat, searchEl.value);
      }

      searchEl.addEventListener('input', () => {
        const activeBtn = catsEl.querySelector('.chip.active');
        const active = activeBtn ? activeBtn.dataset.cat : defaultCat;
        render(active, searchEl.value);
      });

      // Cart state with sanitization
      const loaded = JSON.parse(localStorage.getItem('cart') || '[]');
      const state = { items: sanitizeCart(loaded) };
      function sanitizeCart(list){
        if(!Array.isArray(list)) return [];
        const clean = list.filter(x => x && typeof x.name === 'string' && x.name.trim().length>0
          && typeof x.price === 'string' && /\d/.test(x.price)
          && typeof x.image === 'string'
          && Number.isFinite(parseInt(x.qty,10)) && parseInt(x.qty,10) > 0
        ).map(x => ({ name: x.name.trim(), price: x.price, image: x.image, qty: Math.min(99, parseInt(x.qty,10)) }));
        if(clean.length < list.length){
          localStorage.setItem('cart', JSON.stringify(clean));
        }
        return clean;
      }
      function parsePrice(p){ const m = (p||'').match(/\d+/g); return m ? parseInt(m.join(''),10) : 0; }
      function toFa(n){ return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',').replace(/[0-9]/g, d => '۰۱۲۳۴۵۶۷۸۹'[parseInt(d,10)]); }
      function formatToman(n){ return toFa(n) + ' تومان'; }
      function save(){
        localStorage.setItem('cart', JSON.stringify(state.items));
        badge.textContent = state.items.reduce((a,b)=>a+b.qty,0);
        const total = state.items.reduce((a,b)=>a + parsePrice(b.price)*b.qty, 0);
        cartTotal.textContent = formatToman(total);
        renderCart();
      }
      function addToCart(item){
        const i = state.items.findIndex(x => x.name===item.name);
        if(i>-1) state.items[i].qty += 1;
        else state.items.push({name:item.name, price:item.price, image:item.image, qty:1});
        save();
      }
      function inc(i){ state.items[i].qty = Math.min(99, state.items[i].qty+1); save(); }
      function dec(i){ state.items[i].qty -= 1; if(state.items[i].qty<=0) state.items.splice(i,1); save(); }
      function renderLinePrice(it){ return formatToman(parsePrice(it.price) * it.qty); }
      function renderCart(){
        cartItems.innerHTML='';
        if(state.items.length===0){
          cartItems.innerHTML = '<div style="text-align:center;color:#c9c3b8;padding:18px">سبد خرید شما خالی است</div>';
          return;
        }
        state.items.forEach((it, idx) => {
          const row = document.createElement('div');
          row.className='row';
          row.innerHTML =
            '<img class="thumb" src="'+it.image+'" alt="'+it.name+'"/>'+
            '<div><div class="rn">'+it.name+'</div><div class="rp">'+renderLinePrice(it)+'</div></div>'+
            '<div class="qty">'+
              '<button class="qbtn" aria-label="کم کردن">-</button>'+
              '<div>'+toFa(it.qty)+'</div>'+
              '<button class="qbtn" aria-label="زیاد کردن">+</button>'+
            '</div>';
          const [minus, plus] = row.querySelectorAll('.qbtn');
          minus.addEventListener('click', () => dec(idx));
          plus.addEventListener('click', () => inc(idx));
          cartItems.appendChild(row);
        });
      }

      // Cart open/close (overlay fully hidden when closed)
      fab.addEventListener('click', () => overlay.classList.add('open'));
      closeSheet.addEventListener('click', () => overlay.classList.remove('open'));
      overlay.addEventListener('click', e => { if(e.target === overlay) overlay.classList.remove('open'); });
      modal.addEventListener('click', () => modal.classList.remove('open'));

      // Initial render: ALWAYS start with "شیک‌ها"
      render(defaultCat, '');
      save();
    }

    function getIcons(){
      return {
        "اسموتی‌ها":"fa-blender",
        "موهیتو":"fa-lemon",
        "اسپرسو بار گرم":"fa-mug-hot",
        "اسپرسو بار سرد":"fa-snowflake",
        "ویژه لوچه":"fa-star",
        "صبحانه لوچه":"fa-utensils",
        "میلک شیک فروتی":"fa-ice-cream",
        "کروسان و وافل":"fa-bread-slice"
      };
    }

    function getMenuData(){
      return {
        "اسموتی‌ها": {
          english: "SMOOTHIES",
          icon: "fa-blender",
          items: [
            {name:"توت فرنگی", price:"97-109", description:"آناناس، توت‌فرنگی، کلبیس", image:"1.jpg"},
            {name:"دراگون فروت", price:"97-109", description:"آناناس، دراگون فروت، کلبیس", image:"2.jpg"},
            {name:"آلبالو", price:"93-105", description:"آلبالو، آناناس، سیب، پرتقال", image:""},
            {name:"هندوانه", price:"93-105", description:"هندوانه، لیمو، نعنای تازه", image:""},
            {name:"پرتقال", price:"93-105", description:"پرتقال، لیمو، زنجبیل، آناناس", image:""},
            {name:"موز توت‌فرنگی", price:"93-105", description:"موز، توت‌فرنگی، نارگیل", image:""},
            {name:"آب طالبی", price:"67-77", description:"", image:""}
          ]
        },
        "موهیتو": {
          english: "MOJITO",
          icon: "fa-lemon",
          items: [
            {name:"کلاسیک", price:"93-103", description:"لیمو، نعناع، آب گازدار", image:""},
            {name:"توت‌فرنگی", price:"93-103", description:"لیمو، نعناع، توت‌فرنگی، آب گازدار", image:""},
            {name:"دراگون فروت", price:"93-103", description:"لیمو، نعناع، دراگون فروت، آب گازدار", image:""},
            {name:"هندوانه", price:"95-105", description:"لیمو، نعناع، آب گازدار، هندوانه", image:""}
          ]
        },
        "اسپرسو بار گرم": {
          english: "HOT ESPRESSO BAR",
          icon: "fa-mug-hot",
          items: [
            {name:"اسپرسو", price:"45-55", description:"", image:""},
            {name:"لته", price:"95", description:"", image:""},
            {name:"هات چاکلت", price:"113", description:"", image:""},
            {name:"موکا", price:"113", description:"", image:""},
            {name:"آمریکانو", price:"67", description:"", image:""}
          ]
        },
        "اسپرسو بار سرد": {
          english: "ICED ESPRESSO BAR",
          icon: "fa-snowflake",
          items: [
            {name:"آیس لته", price:"105", description:"", image:""},
            {name:"آیس کارامل ماکیاتو", price:"125", description:"", image:""},
            {name:"دارکولا میلک", price:"110", description:"", image:""}
          ]
        },
        "ویژه لوچه": {
          english: "SPECIALS",
          icon: "fa-star",
          items: [
            {name:"توت فرنگی نوتلا", price:"94", description:"توت‌فرنگی، شکلات، موز، کراستد", image:""},
            {name:"لیمون سیکسونیدا", price:"79-89", description:"لیمو، سیروپ", image:""},
            {name:"آب‌دوغ خیار لوچه", price:"196", description:"", image:""},
            {name:"سبین مزه ایرانی", price:"210", description:"خیار، نعناع، لیمو، آلبالو، بیدمشک، کلبیس، دراگون فروت، نوتلا", image:""},
            {name:"آلبالو فرنچ", price:"76", description:"", image:""},
            {name:"چای زعفرانی نعناع", price:"قیمت درج نشده", description:"", image:""}
          ]
        },
        "صبحانه لوچه": {
          english: "BREAKFAST",
          icon: "fa-utensils",
          items: [
            {name:"پینک شکلات میوه", price:"143", description:"", image:""},
            {name:"مورد دوم", price:"67-87", description:"", image:""}
          ]
        },
        "میلک شیک فروتی": {
          english: "FRUITY MILKSHAKES",
          icon: "fa-ice-cream",
          items: [
            {name:"شیر موز", price:"97-113", description:"", image:""},
            {name:"شیر توت‌فرنگی", price:"97-113", description:"", image:""},
            {name:"شیر آلبالو", price:"97-113", description:"", image:""}
          ]
        },
        "کروسان و وافل": {
          english: "CROISSANT & WAFFLE",
          icon: "fa-bread-slice",
          items: [
            {name:"وافل", price:"127", description:"", image:""},
            {name:"کروسان بستنی", price:"107", description:"", image:""},
            {name:"کروسان توت‌فرنگی، شکلات", price:"139", description:"", image:""},
            {name:"وافل بستنی", price:"97", description:"", image:""}
          ]
        }
      };;
    }
  </script>
</body>
</html>
