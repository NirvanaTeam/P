<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>منوی دیجیتال فست فود | BurgerLand</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* متغیرهای رنگ */
    :root {
      --primary: #E53935; /* قرمز - انرژی و اشتها */
      --secondary: #FFA000; /* نارنجی - گرمی و اشتها */
      --accent: #FFD600; /* زرد - شادی */
      --dark: #212121; /* مشکی - لوکس */
      --light: #F5F5F5; /* سفید */
      --text: #424242; /* متن خاکستری */
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: var(--light);
      color: var(--text);
      overflow-x: hidden;
    }
    
    /* هدر منو */
    .menu-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      text-align: center;
      padding: 2rem 1rem;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    .menu-header::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 30%, rgba(255,255,255,0.1) 1px, transparent 1px),
        radial-gradient(circle at 80% 70%, rgba(255,255,255,0.1) 1px, transparent 1px);
      background-size: 30px 30px;
      animation: float 15s linear infinite;
    }
    
    @keyframes float {
      0% { background-position: 0 0, 0 0; }
      100% { background-position: 30px 30px, 30px 30px; }
    }
    
    .menu-title {
      font-size: 3rem;
      margin-bottom: 0.5rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      position: relative;
      animation: bounce 1s ease;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-20px); }
      60% { transform: translateY(-10px); }
    }
    
    .menu-subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      position: relative;
    }
    
    /* دسته‌بندی‌های منو */
    .menu-categories {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      padding: 1rem;
      background-color: white;
      position: sticky;
      top: 0;
      z-index: 90;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .category-btn {
      background: none;
      border: none;
      padding: 0.8rem 1.5rem;
      margin: 0 0.5rem;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .category-btn::after {
      content: "";
      position: absolute;
      bottom: 0;
      right: 0;
      width: 0;
      height: 3px;
      background-color: var(--primary);
      transition: width 0.3s ease;
    }
    
    .category-btn:hover, .category-btn.active {
      color: var(--primary);
    }
    
    .category-btn:hover::after, .category-btn.active::after {
      width: 100%;
    }
    
    /* آیتم‌های منو */
    .menu-items {
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .menu-section {
      margin-bottom: 3rem;
      animation: fadeIn 0.5s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .section-title {
      font-size: 2rem;
      color: var(--primary);
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 3px solid var(--accent);
      display: inline-block;
    }
    
    .items-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    
    .menu-item {
      background-color: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      position: relative;
      cursor: pointer;
    }
    
    .menu-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
    
    .item-image {
      height: 180px;
      background-color: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      position: relative;
      overflow: hidden;
    }
    
    .item-image::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, rgba(229,57,53,0.3), rgba(255,160,0,0.3));
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .menu-item:hover .item-image::before {
      opacity: 1;
    }
    
    .item-details {
      padding: 1.5rem;
    }
    
    .item-name {
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--dark);
    }
    
    .item-description {
      color: var(--text);
      margin-bottom: 1rem;
      font-size: 0.9rem;
      line-height: 1.6;
    }
    
    .item-price {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 1rem;
      display: block;
    }
    
    .add-to-cart {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 0.7rem 1.5rem;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
    }
    
    .add-to-cart:hover {
      background-color: #C62828;
      transform: translateY(-2px);
    }
    
    .add-to-cart i {
      margin-left: 0.5rem;
      font-size: 1.2rem;
    }
    
    /* سبد خرید */
    .cart-icon {
      position: fixed;
      bottom: 2rem;
      left: 2rem;
      background-color: var(--primary);
      color: white;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      z-index: 100;
      transition: all 0.3s ease;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(229,57,53,0.7); }
      70% { box-shadow: 0 0 0 15px rgba(229,57,53,0); }
      100% { box-shadow: 0 0 0 0 rgba(229,57,53,0); }
    }
    
    .cart-icon:hover {
      transform: scale(1.1);
    }
    
    .cart-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: var(--accent);
      color: var(--dark);
      width: 25px;
      height: 25px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: 700;
    }
    
    /* پنل سبد خرید */
    .cart-panel {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100vh;
      background-color: white;
      box-shadow: -5px 0 15px rgba(0,0,0,0.1);
      z-index: 200;
      transition: right 0.3s ease;
      display: flex;
      flex-direction: column;
    }
    
    .cart-panel.open {
      right: 0;
    }
    
    .cart-header {
      padding: 1.5rem;
      background-color: var(--primary);
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .cart-title {
      font-size: 1.5rem;
      font-weight: 600;
    }
    
    .close-cart {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
    }
    
    .cart-items {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
    }
    
    .cart-item {
      display: flex;
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid #eee;
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .cart-item-image {
      width: 80px;
      height: 80px;
      background-color: #f5f5f5;
      border-radius: 8px;
      margin-left: 1rem;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    
    .cart-item-details {
      flex: 1;
    }
    
    .cart-item-name {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .cart-item-price {
      color: var(--primary);
      font-weight: 600;
    }
    
    .cart-item-actions {
      display: flex;
      align-items: center;
      margin-top: 0.5rem;
    }
    
    .quantity-btn {
      width: 25px;
      height: 25px;
      background-color: #f0f0f0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .quantity {
      margin: 0 0.5rem;
      min-width: 20px;
      text-align: center;
    }
    
    .remove-item {
      margin-right: 1rem;
      color: #e53935;
      background: none;
      border: none;
      cursor: pointer;
    }
    
    .cart-footer {
      padding: 1.5rem;
      background-color: #f9f9f9;
      border-top: 1px solid #eee;
    }
    
    .cart-total {
      display: flex;
      justify-content: space-between;
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
    }
    
    .checkout-btn {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 1rem;
      width: 100%;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .checkout-btn:hover {
      background-color: #C62828;
    }
    
    /* فرم تکمیل سفارش (به‌روزرسانی شده) */
    .checkout-form {
      display: none;
      padding: 1.5rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .form-group input, 
    .form-group textarea {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1rem;
    }
    
    /* استایل برای نمایش لوکیشن انتخاب‌شده */
    #locationDisplay {
      background: #f0f0f0;
      padding: 0.8rem;
      border-radius: 4px;
      font-size: 0.95rem;
    }
    
    /* استایل پاپ‌آپ دریافت لوکیشن */
    #locationModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 300;
    }
    
    #locationModal .modal-content {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      position: relative;
    }
    
    #locationModal .modal-content button#closeLocationModal {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
    }
    
    /* رسپانسیو */
    @media (max-width: 768px) {
      .menu-title {
        font-size: 2.2rem;
      }
      
      .items-grid {
        grid-template-columns: 1fr;
      }
      
      .cart-panel {
        width: 100%;
        right: -100%;
      }
      
      .cart-panel.open {
        right: 0;
      }
    }
  </style>
</head>
<body>
  <!-- هدر منو -->
  <header class="menu-header">
    <h1 class="menu-title">BurgerLand</h1>
    <p class="menu-subtitle">منوی دیجیتال فست فود</p>
  </header>
  
  <!-- دسته‌بندی‌ها -->
  <div class="menu-categories">
    <button class="category-btn active" data-category="all">همه</button>
    <button class="category-btn" data-category="burgers">برگرها</button>
    <button class="category-btn" data-category="sandwiches">ساندویچ‌ها</button>
    <button class="category-btn" data-category="sides">پیش‌غذاها</button>
    <button class="category-btn" data-category="drinks">نوشیدنی‌ها</button>
  </div>
  
  <!-- آیتم‌های منو -->
  <div class="menu-items">
    <!-- بخش برگرها -->
    <div class="menu-section" id="burgers" data-category="burgers">
      <h2 class="section-title">برگرها</h2>
      <div class="items-grid">
        <!-- آیتم 1 -->
        <div class="menu-item">
          <div class="item-image">🍔</div>
          <div class="item-details">
            <h3 class="item-name">برگر کلاسیک</h3>
            <p class="item-description">نان برگر، پتی ۱۵۰ گرمی، پنیر چدار، کاهو، گوجه، پیاز، سس مخصوص</p>
            <span class="item-price">۸۵,۰۰۰ تومان</span>
            <button class="add-to-cart">افزودن به سبد <i class="fas fa-cart-plus"></i></button>
          </div>
        </div>
        <!-- آیتم 2 -->
        <div class="menu-item">
          <div class="item-image">🍔</div>
          <div class="item-details">
            <h3 class="item-name">برگر دبل چیز</h3>
            <p class="item-description">دو پتی ۱۵۰ گرمی، دو لایه پنیر چدار، قارچ، پیاز کاراملی، سس باربیکیو</p>
            <span class="item-price">۱۲۰,۰۰۰ تومان</span>
            <button class="add-to-cart">افزودن به سبد <i class="fas fa-cart-plus"></i></button>
          </div>
        </div>
        <!-- آیتم 3 -->
        <div class="menu-item">
          <div class="item-image">🍔</div>
          <div class="item-details">
            <h3 class="item-name">برگر اسپایسی</h3>
            <p class="item-description">پتی ۲۰۰ گرمی، پنیر پپر جک، فلفل تند، پیاز، سس تند مخصوص</p>
            <span class="item-price">۹۵,۰۰۰ تومان</span>
            <button class="add-to-cart">افزودن به سبد <i class="fas fa-cart-plus"></i></button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- بخش ساندویچ‌ها -->
    <div class="menu-section" id="sandwiches" data-category="sandwiches">
      <h2 class="section-title">ساندویچ‌ها</h2>
      <div class="items-grid">
        <!-- آیتم 1 -->
        <div class="menu-item">
          <div class="item-image">🥪</div>
          <div class="item-details">
            <h3 class="item-name">ساندویچ مرغ</h3>
            <p class="item-description">فیله مرغ سوخاری، کاهو، گوجه، مایونز، نان باگت</p>
            <span class="item-price">۷۵,۰۰۰ تومان</span>
            <button class="add-to-cart">افزودن به سبد <i class="fas fa-cart-plus"></i></button>
          </div>
        </div>
        <!-- آیتم 2 -->
        <div class="menu-item">
          <div class="item-image">🥪</div>
          <div class="item-details">
            <h3 class="item-name">ساندویچ چیکن چیز</h3>
            <p class="item-description">فیله مرغ گریل شده، پنیر موزارلا، قارچ، سس مخصوص</p>
            <span class="item-price">۸۵,۰۰۰ تومان</span>
            <button class="add-to-cart">افزودن به سبد <i class="fas fa-cart-plus"></i></button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- بخش پیش‌غذاها -->
    <div class="menu-section" id="sides" data-category="sides">
      <h2 class="section-title">پیش‌غذاها</h2>
      <div class="items-grid">
        <!-- آیتم 1 -->
        <div class="menu-item">
          <div class="item-image">🍟</div>
          <div class="item-details">
            <h3 class="item-name">سیب‌زمینی سرخ کرده</h3>
            <p class="item-description">سیب‌زمینی خلالی با نمک و ادویه مخصوص، سس قرمز</p>
            <span class="item-price">۴۵,۰۰۰ تومان</span>
            <button class="add-to-cart">افزودن به سبد <i class="fas fa-cart-plus"></i></button>
          </div>
        </div>
        <!-- آیتم 2 -->
        <div class="menu-item">
          <div class="item-image">🧅</div>
          <div class="item-details">
            <h3 class="item-name">پیاز سوخاری</h3>
            <p class="item-description">پیاز خلالی سوخاری با آرد مخصوص، سس باربیکیو</p>
            <span class="item-price">۵۵,۰۰۰ تومان</span>
            <button class="add-to-cart">افزودن به سبد <i class="fas fa-cart-plus"></i></button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- بخش نوشیدنی‌ها -->
    <div class="menu-section" id="drinks" data-category="drinks">
      <h2 class="section-title">نوشیدنی‌ها</h2>
      <div class="items-grid">
        <!-- آیتم 1 -->
        <div class="menu-item">
          <div class="item-image">🥤</div>
          <div class="item-details">
            <h3 class="item-name">نوشابه گازدار</h3>
            <p class="item-description">کوکاکولا، فانتا، اسپرایت، مائوتا (۳۳۰ میلی‌لیتر)</p>
            <span class="item-price">۳۰,۰۰۰ تومان</span>
            <button class="add-to-cart">افزودن به سبد <i class="fas fa-cart-plus"></i></button>
          </div>
        </div>
        <!-- آیتم 2 -->
        <div class="menu-item">
          <div class="item-image">🧃</div>
          <div class="item-details">
            <h3 class="item-name">آبمیوه طبیعی</h3>
            <p class="item-description">پرتقال، انبه، هویج (۲۵۰ میلی‌لیتر)</p>
            <span class="item-price">۴۰,۰۰۰ تومان</span>
            <button class="add-to-cart">افزودن به سبد <i class="fas fa-cart-plus"></i></button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- سبد خرید -->
  <div class="cart-icon" id="cartIcon">
    <i class="fas fa-shopping-cart"></i>
    <span class="cart-count">0</span>
  </div>
  
  <!-- پنل سبد خرید -->
  <div class="cart-panel" id="cartPanel">
    <div class="cart-header">
      <h3 class="cart-title">سبد خرید شما</h3>
      <button class="close-cart" id="closeCart"><i class="fas fa-times"></i></button>
    </div>
    <div class="cart-items" id="cartItems">
      <!-- آیتم‌های سبد خرید اینجا نمایش داده می‌شوند -->
    </div>
    <div class="cart-footer">
      <div class="cart-total">
        <span>جمع کل:</span>
        <span id="cartTotal">۰ تومان</span>
      </div>
      <button class="checkout-btn" id="checkoutBtn">تکمیل سفارش</button>
    </div>
    
    <!-- فرم تکمیل سفارش (به‌روزرسانی شده) -->
    <div class="checkout-form" id="checkoutForm">
      <div class="form-group">
        <label for="name">نام کامل</label>
        <input type="text" id="name" required>
      </div>
      <div class="form-group">
        <label for="phone">شماره تماس</label>
        <input type="tel" id="phone" required>
      </div>
      <div class="form-group">
        <label for="address">آدرس (اختیاری)</label>
        <textarea id="address"></textarea>
      </div>
      <!-- دریافت لوکیشن از طریق دکمه -->
      <div class="form-group">
        <button type="button" id="getLocationBtn" class="checkout-btn">دریافت لوکیشن</button>
        <div id="locationDisplay" style="margin-top: 1rem;">
          موقعیت انتخاب شده: <span id="locationCoordinates">هنوز انتخاب نشده</span>
        </div>
      </div>
      <button type="button" class="checkout-btn" id="submitOrder">تایید</button>
      <button type="button" class="back-to-cart" id="backToCart">بازگشت به سبد خرید</button>
    </div>
    
    <!-- پیام تایید (پس از ثبت سفارش؛ همانند نسخه اصلی) -->
    <div class="verify-message" id="verifyMessage" style="display: none; text-align: center; padding: 2rem;">
      <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
      <p>سفارش شما با موفقیت ثبت شد!</p>
      <p>لطفاً کد 4 رقمی که براتون پیامک شد را ارسال کنید</p>
      <button type="button" class="back-to-cart" id="backToMenu">بازگشت به منو</button>
    </div>
  </div>
  
  <!-- پاپ‌آپ دریافت لوکیشن -->
  <div id="locationModal">
    <div class="modal-content">
      <button id="closeLocationModal">&times;</button>
      <div id="modalMap" style="width: 100%; height: 300px; margin-bottom: 1rem;"></div>
      <button type="button" id="confirmLocation" class="checkout-btn">تایید موقعیت</button>
    </div>
  </div>
  
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // متغیرهای سبد خرید و لوکیشن
      let cart = [];
      let userLocation = null;
      let modalMap = null, modalMarker = null, selectedLocation = null;
      
      const cartIcon = document.getElementById('cartIcon');
      const cartPanel = document.getElementById('cartPanel');
      const closeCart = document.getElementById('closeCart');
      const cartItemsContainer = document.getElementById('cartItems');
      const cartTotalElement = document.getElementById('cartTotal');
      const cartCount = document.querySelector('.cart-count');
      const checkoutBtn = document.getElementById('checkoutBtn');
      const checkoutForm = document.getElementById('checkoutForm');
      const submitOrder = document.getElementById('submitOrder');
      const backToCart = document.getElementById('backToCart');
      const verifyMessage = document.getElementById('verifyMessage');
      const backToMenu = document.getElementById('backToMenu');
      
      const getLocationBtn = document.getElementById('getLocationBtn');
      const locationCoordinatesSpan = document.getElementById('locationCoordinates');
      const locationModal = document.getElementById('locationModal');
      const closeLocationModal = document.getElementById('closeLocationModal');
      const confirmLocation = document.getElementById('confirmLocation');
      
      // تابع کمکی: تبدیل ارقام فارسی به انگلیسی
      function persianToEnglish(str) {
        const persianDigits = ['۰','۱','۲','۳','۴','۵','۶','۷','۸','۹'];
        for (let i = 0; i < persianDigits.length; i++) {
          str = str.replace(new RegExp(persianDigits[i], "g"), i);
        }
        return str;
      }
      
      // باز و بسته کردن پنل سبد خرید
      cartIcon.addEventListener('click', function() {
        cartPanel.classList.add('open');
      });
      
      closeCart.addEventListener('click', function() {
        cartPanel.classList.remove('open');
      });
      
      // فیلتر کردن آیتم‌های منو
      const categoryButtons = document.querySelectorAll('.category-btn');
      const menuSections = document.querySelectorAll('.menu-section');
      
      categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
          categoryButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          const selectedCategory = this.dataset.category;
          
          menuSections.forEach(section => {
            section.style.display = 'none';
          });
          
          if (selectedCategory === 'all') {
            menuSections.forEach(section => {
              section.style.display = 'block';
              section.style.animation = 'fadeIn 0.5s ease';
            });
          } else {
            const targetSection = document.querySelector(`.menu-section[data-category="${selectedCategory}"]`);
            if (targetSection) {
              targetSection.style.display = 'block';
              targetSection.style.animation = 'fadeIn 0.5s ease';
            }
          }
        });
      });
      
      // افزودن آیتم به سبد خرید
      const addToCartButtons = document.querySelectorAll('.add-to-cart');
      addToCartButtons.forEach(button => {
        button.addEventListener('click', function() {
          const menuItem = this.closest('.menu-item');
          const itemName = menuItem.querySelector('.item-name').textContent;
          const rawPrice = menuItem.querySelector('.item-price').textContent;
          // حذف کاراکترهای غیر عددی بعد از تبدیل
          const itemPrice = parseInt(persianToEnglish(rawPrice).replace(/[^0-9]/g, ''));
          const itemImage = menuItem.querySelector('.item-image').textContent;
          
          // بررسی وجود آیتم در سبد خرید
          const existingItem = cart.find(item => item.name === itemName);
          
          if (existingItem) {
            existingItem.quantity++;
          } else {
            cart.push({
              name: itemName,
              price: itemPrice,
              quantity: 1,
              image: itemImage
            });
          }
          
          updateCart();
          
          // انیمیشن افزودن به سبد
          const cartRect = cartIcon.getBoundingClientRect();
          const buttonRect = this.getBoundingClientRect();
          
          const flyingItem = document.createElement('div');
          flyingItem.style.position = 'fixed';
          flyingItem.style.left = `${buttonRect.left}px`;
          flyingItem.style.top = `${buttonRect.top}px`;
          flyingItem.style.fontSize = '1.5rem';
          flyingItem.style.zIndex = '1000';
          flyingItem.style.transition = 'all 0.5s ease';
          flyingItem.innerHTML = itemImage;
          document.body.appendChild(flyingItem);
          
          setTimeout(() => {
            flyingItem.style.left = `${cartRect.left}px`;
            flyingItem.style.top = `${cartRect.top}px`;
            flyingItem.style.transform = 'scale(0.5)';
            flyingItem.style.opacity = '0.5';
          }, 10);
          
          setTimeout(() => {
            document.body.removeChild(flyingItem);
          }, 500);
        });
      });
      
      // به‌روزرسانی سبد خرید
      function updateCart() {
        const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
        cartCount.textContent = totalItems;
        
        const totalPrice = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        cartTotalElement.textContent = totalPrice.toLocaleString('fa-IR') + ' تومان';
        
        cartItemsContainer.innerHTML = '';
        
        if (cart.length === 0) {
          cartItemsContainer.innerHTML = '<p style="text-align: center; padding: 2rem;">سبد خرید شما خالی است</p>';
          return;
        }
        
        cart.forEach((item, index) => {
          const cartItemElement = document.createElement('div');
          cartItemElement.className = 'cart-item';
          cartItemElement.innerHTML = `
            <div class="cart-item-image">${item.image}</div>
            <div class="cart-item-details">
              <div class="cart-item-name">${item.name}</div>
              <div class="cart-item-price">${item.price.toLocaleString('fa-IR')} تومان</div>
              <div class="cart-item-actions">
                <button class="remove-item" data-index="${index}"><i class="fas fa-trash"></i></button>
                <button class="quantity-btn minus" data-index="${index}">-</button>
                <span class="quantity">${item.quantity}</span>
                <button class="quantity-btn plus" data-index="${index}">+</button>
              </div>
            </div>
          `;
          cartItemsContainer.appendChild(cartItemElement);
        });
        
        document.querySelectorAll('.remove-item').forEach(button => {
          button.addEventListener('click', function() {
            const index = parseInt(this.dataset.index);
            cart.splice(index, 1);
            updateCart();
          });
        });
        
        document.querySelectorAll('.quantity-btn.minus').forEach(button => {
          button.addEventListener('click', function() {
            const index = parseInt(this.dataset.index);
            if (cart[index].quantity > 1) {
              cart[index].quantity--;
            } else {
              cart.splice(index, 1);
            }
            updateCart();
          });
        });
        
        document.querySelectorAll('.quantity-btn.plus').forEach(button => {
          button.addEventListener('click', function() {
            const index = parseInt(this.dataset.index);
            cart[index].quantity++;
            updateCart();
          });
        });
      }
      
      // دریافت موقعیت (لوکیشن) از پاپ‌آپ
      getLocationBtn.addEventListener('click', function() {
        locationModal.style.display = 'flex';
        // اگر نقشه قبلاً ساخته نشده، آن را ایجاد می‌کنیم.
        if (!modalMap) {
          const defaultPosition = [35.6953385, 51.2542623];
          modalMap = L.map('modalMap').setView(defaultPosition, 13);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
          }).addTo(modalMap);
          modalMarker = L.marker(defaultPosition, {draggable: true}).addTo(modalMap);
          
          modalMarker.on('dragend', function() {
            const pos = modalMarker.getLatLng();
            selectedLocation = { lat: pos.lat, lng: pos.lng };
          });
          
          modalMap.on('click', function(e) {
            selectedLocation = { lat: e.latlng.lat, lng: e.latlng.lng };
            modalMarker.setLatLng(e.latlng);
          });
          selectedLocation = { lat: defaultPosition[0], lng: defaultPosition[1] };
        }
      });
      
      closeLocationModal.addEventListener('click', function() {
        locationModal.style.display = 'none';
      });
      
      confirmLocation.addEventListener('click', function() {
        locationModal.style.display = 'none';
        if (selectedLocation) {
          userLocation = selectedLocation;
          locationCoordinatesSpan.textContent = `(${userLocation.lat.toFixed(6)}, ${userLocation.lng.toFixed(6)})`;
        }
      });
      
      // مدیریت فرآیند تسویه حساب
      checkoutBtn.addEventListener('click', function() {
        if (cart.length === 0) {
          alert('سبد خرید شما خالی است!');
          return;
        }
        cartItemsContainer.style.display = 'none';
        document.querySelector('.cart-footer').style.display = 'none';
        checkoutForm.style.display = 'block';
      });
      
      backToCart.addEventListener('click', function() {
        cartItemsContainer.style.display = 'block';
        document.querySelector('.cart-footer').style.display = 'flex';
        checkoutForm.style.display = 'none';
      });
      
      // ارسال اطلاعات سفارش به واتساپ پس از زدن "تایید"
      submitOrder.addEventListener('click', function() {
        const name = document.getElementById('name').value;
        const phone = document.getElementById('phone').value;
        const address = document.getElementById('address').value;
        
        if (!name || !phone) {
          alert('لطفاً نام و شماره تماس خود را وارد کنید');
          return;
        }
        if (!userLocation) {
          alert('لطفاً موقعیت مکانی را دریافت کنید');
          return;
        }
        
        // ساخت پیام سفارش
        let message = "سفارش از BurgerLand:\n\n";
        message += `نام: ${name}\n`;
        message += `شماره تماس: ${phone}\n`;
        message += `آدرس: ${address || '---'}\n`;
        message += `موقعیت مکانی: (${userLocation.lat.toFixed(6)}, ${userLocation.lng.toFixed(6)})\n\n`;
        message += "سفارش:\n";
        cart.forEach(item => {
          message += `${item.name} - تعداد: ${item.quantity} - قیمت واحد: ${item.price.toLocaleString('fa-IR')} تومان\n`;
        });
        const totalPrice = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        message += `\nجمع کل: ${totalPrice.toLocaleString('fa-IR')} تومان`;
        
        // شماره واتساپ: حذف + برای فرم صحیح URL
        const whatsappNumber = "989334479527";
        const whatsappUrl = "https://api.whatsapp.com/send?phone=" + whatsappNumber + "&text=" + encodeURIComponent(message);
        window.open(whatsappUrl, '_blank');
      });
      
      backToMenu.addEventListener('click', function() {
        cart = [];
        updateCart();
        verifyMessage.style.display = 'none';
        cartItemsContainer.style.display = 'block';
        document.querySelector('.cart-footer').style.display = 'flex';
        cartPanel.classList.remove('open');
        
        document.getElementById('name').value = '';
        document.getElementById('phone').value = '';
        document.getElementById('address').value = '';
        locationCoordinatesSpan.textContent = "هنوز انتخاب نشده";
      });
      
      // انیمیشن اسکرول برای بخش‌های منو
      function animateOnScroll() {
        menuSections.forEach(section => {
          const sectionPosition = section.getBoundingClientRect().top;
          const screenPosition = window.innerHeight / 1.2;
          
          if (sectionPosition < screenPosition) {
            section.style.opacity = '1';
            section.style.transform = 'translateY(0)';
          }
        });
      }
      
      menuSections.forEach(section => {
        section.style.opacity = '0';
        section.style.transform = 'translateY(20px)';
        section.style.transition = 'all 0.6s ease';
      });
      
      window.addEventListener('scroll', animateOnScroll);
      animateOnScroll();
    });
  </script>
</body>
</html>
