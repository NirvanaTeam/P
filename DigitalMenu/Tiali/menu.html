<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>کافه تیالی | منوی موبایل</title>

  <!-- Bootstrap RTL (only for mobile) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet"/>

  <style>
    :root{
      --appbar-h: 60px;
      --rail-w: 84px;  /* دسته‌بندی سمت راست */
      --radius: 14px;
      --brand: #2f3e46;
      --accent: #0d6efd; /* می‌تونه بعداً با هویت تیالی عوض بشه */
      --muted: #6c757d;
      --bg-soft: #f8f9fa;
      --card-shadow: 0 6px 20px rgba(0,0,0,.06);
    }

    body{ background:#fff; }

    /* App bar */
    .appbar{
      height: var(--appbar-h);
      -webkit-backdrop-filter: saturate(180%) blur(14px);
      backdrop-filter: saturate(180%) blur(14px);
      background: rgba(255,255,255,.85);
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .brand{
      font-weight: 800;
      color: var(--brand);
      letter-spacing: .3px;
    }

    /* دسته‌بندی عمودی سمت راست */
    #catRail{
      position: fixed;
      top: var(--appbar-h);
      bottom: 0;
      right: 0;
      width: var(--rail-w);
      z-index: 998;
      background: #fff;
      border-left: 1px solid rgba(0,0,0,.06);
      padding: 8px 6px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    .cat-btn{
      display: flex; align-items: center; justify-content: center;
      text-align: center;
      min-height: 44px;
      padding: 8px 6px;
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,.04);
      font-size: 12px; line-height: 1.2;
      color: #222;
    }
    .cat-btn.active{
      border-color: var(--accent);
      box-shadow: 0 6px 16px rgba(13,110,253,.15);
      color: var(--accent);
      font-weight: 700;
    }

    /* فضای محتوا کنار ریل راست */
    main{
      padding-top: var(--appbar-h);
      padding-bottom: 90px; /* جا برای CTA پایین اگر بعداً خواستی */
    }
    .content{
      margin-right: calc(var(--rail-w) + 8px);
      padding: 12px;
    }

    /* بخش‌ها و آیتم‌ها (کمپکت) */
    .section-title{
      font-weight: 800;
      font-size: 18px;
      color: #111;
      margin: 10px 0 6px;
      scroll-margin-top: calc(var(--appbar-h) + 8px);
    }
    .menu-item{
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 6px;
      border-bottom: 1px solid rgba(0,0,0,.05);
      min-height: 82px; /* جمع‌وجور */
    }
    .thumb{
      width: 68px; height: 68px; border-radius: 12px; flex: 0 0 68px;
      background: #eee; overflow: hidden; border: 1px solid rgba(0,0,0,.06);
    }
    .thumb img{ width: 100%; height: 100%; object-fit: cover; display: block; }
    .mi-text{ flex: 1 1 auto; min-width: 0; }
    .mi-name{
      font-weight: 700; font-size: 14px; color:#111;
      display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    }
    .mi-desc{
      color: var(--muted); font-size: 12px;
      display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden;
    }
    .mi-foot{ display:flex; align-items:center; justify-content:space-between; margin-top:4px; }
    .price{ font-weight:800; font-size:13px; color:#222; }
    .add-btn{
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 100px;
      padding: 6px 10px;
      font-weight: 700;
      background:#fff;
    }

    /* Badge سبد خرید در اپ‌بار */
    .cart-btn{
      position: relative;
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 12px;
      background:#fff;
      padding: 8px 12px;
    }
    .cart-badge{
      position: absolute; top: -6px; left: -6px;
      background: #dc3545;
      color:#fff; font-size: 11px; font-weight: 800;
      padding: 2px 6px; border-radius: 999px;
      min-width: 20px; text-align:center;
      box-shadow: 0 2px 8px rgba(220,53,69,.35);
    }

    /* سبد خرید فول‌اسکرین */
    .cart-overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.18);
      display: none;
      z-index: 1200;
    }
    .cart-sheet{
      position: absolute;
      bottom: 0; right: 0; left: 0;
      height: 92vh; /* بزرگ و تقریباً تمام‌صفحه */
      background: #fff;
      border-top-left-radius: 18px;
      border-top-right-radius: 18px;
      box-shadow: 0 -20px 40px rgba(0,0,0,.15);
      transform: translateY(100%);
      transition: transform .32s ease;
      display: flex; flex-direction: column;
    }
    .cart-overlay.show{ display:block; }
    .cart-overlay.show .cart-sheet{ transform: translateY(0); }

    .cart-header{
      padding: 14px 16px; border-bottom: 1px solid rgba(0,0,0,.06);
      display:flex; align-items:center; justify-content:space-between;
    }
    .cart-title{ font-weight:800; font-size:16px; }
    .cart-body{
      flex: 1 1 auto;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding: 8px 12px 90px;
    }
    .cart-item{
      display:flex; align-items:center; gap:10px;
      padding:10px 8px; border-bottom: 1px solid rgba(0,0,0,.05);
    }
    .ci-thumb{ width:48px; height:48px; border-radius:10px; overflow:hidden; background:#f1f1f1; flex:0 0 48px; }
    .ci-name{ font-weight:700; font-size:13px; color:#111; }
    .ci-price{ font-weight:800; font-size:12px; color:#222; }
    .qty{
      display:flex; align-items:center; gap:6px;
      border:1px solid rgba(0,0,0,.08); border-radius:999px; padding:4px 8px;
    }
    .qty button{ border:0; background:#fff; width:28px; height:28px; border-radius:999px; }
    .qty span{ min-width:22px; text-align:center; font-weight:800; }

    .cart-footer{
      position: absolute; bottom: 0; right:0; left:0;
      padding: 10px 12px;
      background: #fff;
      border-top: 1px solid rgba(0,0,0,.08);
    }
    .total-line{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; font-weight:800; }
    .checkout-btn{
      width:100%; border-radius:12px; padding:12px 14px; font-weight:800;
      box-shadow: 0 8px 24px rgba(13,110,253,.25);
    }

    /* Placeholder thumb via inline SVG keeps it light */
    .ph {
      background-image: url('data:image/svg+xml;utf8,       <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">       <rect width="200" height="200" fill="%23e9ecef"/>       <circle cx="100" cy="70" r="36" fill="%23ced4da"/>       <rect x="36" y="128" width="128" height="12" rx="6" fill="%23ced4da"/>       <rect x="56" y="148" width="88" height="12" rx="6" fill="%23dee2e6"/>       </svg>');
      background-size: cover; background-position: center;
    }

    /* فقط موبایل: اگه کسی اتفاقی روی دسکتاپ باز کرد */
    @media (min-width: 640px){
      body::before{
        content:"این نسخه فقط برای موبایل طراحی شده است";
        position: fixed; inset: 0; background:#fff; display:flex; align-items:center; justify-content:center;
        z-index:2000; font-weight:800; color:#111;
      }
    }
  </style>
</head>
<body>

  <!-- App Bar -->
  <header class="appbar fixed-top d-flex align-items-center justify-content-between px-3">
    <div class="d-flex align-items-center gap-2">
      <span class="brand">کافه تیالی</span>
    </div>
    <button id="btnCart" class="cart-btn">
      <span class="me-1">سبد خرید</span>
      <span id="cartBadge" class="cart-badge d-none">0</span>
    </button>
  </header>

  <!-- دسته‌بندی عمودی (راست) -->
  <nav id="catRail" aria-label="دسته‌بندی"></nav>

  <main>
    <div class="content">
      <!-- بخش‌ها اینجا با JS از روی داده‌ها ساخته می‌شن -->
      <div id="sections"></div>
    </div>
  </main>

  <!-- سبد خرید فول‌اسکرین -->
  <aside id="cartOverlay" class="cart-overlay" aria-hidden="true">
    <div class="cart-sheet">
      <div class="cart-header">
        <div class="cart-title">سبد خرید</div>
        <button id="closeCart" class="btn btn-link text-decoration-none">بستن</button>
      </div>
      <div id="cartBody" class="cart-body"></div>
      <div class="cart-footer">
        <div class="total-line">
          <span>جمع کل</span>
          <span id="grandTotal">۰ تومان</span>
        </div>
        <button class="btn btn-primary checkout-btn">ثبت سفارش</button>
      </div>
    </div>
  </aside>

  <script>
    // ----- داده نمونه (می‌تونی بعداً جایگزین کنی) -----
    const MENU = [
      {id:'c1', cat:'قهوه', name:'اسپرسو', desc:'ساده و غلیظ', price:80000},
      {id:'c2', cat:'قهوه', name:'آمریکانو', desc:'ملایم و طولانی', price:90000},
      {id:'c3', cat:'قهوه', name:'کاپوچینو', desc:'فوم شیر + اسپرسو', price:120000},
      {id:'t1', cat:'چای', name:'چای سیاه ممتاز', desc:'سنتی ایرانی', price:50000},
      {id:'t2', cat:'چای', name:'چای سبز', desc:'لطیف و آرامش‌بخش', price:60000},
      {id:'h1', cat:'دمنوش', name:'دمنوش نعناع', desc:'خنک و سبک', price:70000},
      {id:'h2', cat:'دمنوش', name:'دمنوش بابونه', desc:'ریلکس‌کننده', price:75000},
      {id:'c4', cat:'نوشیدنی سرد', name:'آیس لاته', desc:'سرد و خامه‌ای', price:140000},
      {id:'c5', cat:'نوشیدنی سرد', name:'موهیتو', desc:'نعنا و لیمو', price:130000},
      {id:'f1', cat:'صبحانه', name:'کراتسان کره‌ای', desc:'تازه و کره‌ای', price:110000},
      {id:'d1', cat:'کیک و دسر', name:'چیزکیک', desc:'کلاسیک و خامه‌ای', price:150000},
    ];

    // ----- ابزارهای کوچک -----
    const fmt = n => new Intl.NumberFormat('fa-IR').format(n) + ' تومان';

    // ----- ساخت ریل دسته‌بندی و بخش‌ها -----
    const catRail = document.getElementById('catRail');
    const sections = document.getElementById('sections');

    const CATS = [...new Set(MENU.map(m => m.cat))];

    // ساخت ریل راست
    CATS.forEach((c,i) => {
      const b = document.createElement('button');
      b.className = 'cat-btn' + (i===0 ? ' active' : '');
      b.textContent = c;
      b.dataset.target = 'sec-' + c;
      b.addEventListener('click', () => {
        document.getElementById(b.dataset.target).scrollIntoView({behavior:'smooth', block:'start'});
      });
      catRail.appendChild(b);
    });

    // ساخت بخش‌ها و آیتم‌ها (کمپکت)
    CATS.forEach(cat => {
      const sec = document.createElement('section');
      sec.id = 'sec-' + cat;
      const h = document.createElement('h2');
      h.className = 'section-title';
      h.textContent = cat;
      sec.appendChild(h);

      MENU.filter(m => m.cat===cat).forEach(m => {
        const row = document.createElement('div');
        row.className = 'menu-item';

        const th = document.createElement('div');
        th.className = 'thumb ph';
        const im = document.createElement('img');
        im.loading = 'lazy';
        im.alt = m.name;
        im.style.display = 'none'; // اگر بعداً تصویر گذاشتی، این رو نمایان کن
        th.appendChild(im);

        const text = document.createElement('div');
        text.className = 'mi-text';
        const nm = document.createElement('div');
        nm.className = 'mi-name'; nm.textContent = m.name;
        const ds = document.createElement('div');
        ds.className = 'mi-desc'; ds.textContent = m.desc || '';
        const foot = document.createElement('div');
        foot.className = 'mi-foot';
        const pr = document.createElement('div');
        pr.className = 'price'; pr.textContent = fmt(m.price);
        const add = document.createElement('button');
        add.className = 'add-btn';
        add.textContent = 'افزودن';
        add.addEventListener('click', () => addToCart(m));

        foot.appendChild(pr); foot.appendChild(add);
        text.appendChild(nm); text.appendChild(ds); text.appendChild(foot);

        row.appendChild(th); row.appendChild(text);
        sec.appendChild(row);
      });

      sections.appendChild(sec);
    });

    // هایلایت دسته فعال با IntersectionObserver
    const observer = new IntersectionObserver((entries)=>{
      const visible = entries.filter(e => e.isIntersecting).sort((a,b)=> b.intersectionRatio - a.intersectionRatio);
      if(!visible.length) return;
      const id = visible[0].target.id;
      document.querySelectorAll('.cat-btn').forEach(b => {
        b.classList.toggle('active', b.dataset.target === id);
      });
    }, {rootMargin: "-40% 0px -55% 0px", threshold:[0, .2, .4, .6, .8, 1]});
    document.querySelectorAll('section[id^="sec-"]').forEach(s => observer.observe(s));

    // ----- سبد خرید -----
    const cartOverlay = document.getElementById('cartOverlay');
    const cartBody = document.getElementById('cartBody');
    const btnCart = document.getElementById('btnCart');
    const closeCart = document.getElementById('closeCart');
    const cartBadge = document.getElementById('cartBadge');
    const grandTotal = document.getElementById('grandTotal');

    const CART = new Map();

    const refreshBadge = () => {
      const count = Array.from(CART.values()).reduce((s,it)=> s + it.qty, 0);
      if(count > 0){
        cartBadge.classList.remove('d-none');
        cartBadge.textContent = count;
      }else{
        cartBadge.classList.add('d-none');
      }
    };

    function addToCart(item){
      const cur = CART.get(item.id) || { ...item, qty:0 };
      cur.qty += 1;
      CART.set(item.id, cur);
      refreshBadge();
      renderCart();
    }

    function changeQty(id, delta){
      const cur = CART.get(id);
      if(!cur) return;
      cur.qty += delta;
      if(cur.qty <= 0) CART.delete(id);
      else CART.set(id, cur);
      refreshBadge();
      renderCart();
    }

    function renderCart(){
      cartBody.innerHTML = '';
      let total = 0;

      CART.forEach(ci => {
        total += ci.price * ci.qty;

        const row = document.createElement('div');
        row.className = 'cart-item';

        const th = document.createElement('div'); th.className = 'ci-thumb ph';
        const info = document.createElement('div'); info.style.flex = '1 1 auto'; info.style.minWidth='0';

        const top = document.createElement('div');
        top.style.display='flex'; top.style.alignItems='center'; top.style.justifyContent='space-between'; top.style.gap='8px';
        const name = document.createElement('div'); name.className='ci-name'; name.textContent = ci.name;
        const price = document.createElement('div'); price.className='ci-price'; price.textContent = fmt(ci.price * ci.qty);
        top.appendChild(name); top.appendChild(price);

        const bottom = document.createElement('div');
        bottom.style.marginTop='6px';
        bottom.style.display='flex'; bottom.style.alignItems='center'; bottom.style.justifyContent='space-between';
        const desc = document.createElement('div'); desc.className='text-muted small'; desc.textContent = ci.desc || '';
        const qty = document.createElement('div'); qty.className='qty';
        const minus = document.createElement('button'); minus.textContent='−';
        const num = document.createElement('span'); num.textContent = ci.qty;
        const plus = document.createElement('button'); plus.textContent='+';
        minus.addEventListener('click', ()=> changeQty(ci.id, -1));
        plus.addEventListener('click', ()=> changeQty(ci.id, +1));
        qty.append(minus, num, plus);

        bottom.appendChild(desc); bottom.appendChild(qty);

        info.appendChild(top); info.appendChild(bottom);

        row.appendChild(th); row.appendChild(info);
        cartBody.appendChild(row);
      });

      grandTotal.textContent = fmt(total);
    }

    btnCart.addEventListener('click', ()=>{
      renderCart();
      cartOverlay.classList.add('show');
      cartOverlay.setAttribute('aria-hidden','false');
    });
    closeCart.addEventListener('click', ()=>{
      cartOverlay.classList.remove('show');
      cartOverlay.setAttribute('aria-hidden','true');
    });
    cartOverlay.addEventListener('click', (e)=>{
      if(e.target === cartOverlay){
        cartOverlay.classList.remove('show');
        cartOverlay.setAttribute('aria-hidden','true');
      }
    });

  </script>
</body>
</html>
