<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>انتخاب رندوم — نسخه موبایل</title>
<style>
  :root{
    --bg:#0b0d11;
    --panel:#111520;
    --accent:#ff8d3a;
    --accent2:#4ac2ff;
    --ok:#28c76f;
    --text:#e9eef7;
    --muted:#9fb0c3;
    --tile: 40px;   /* پایه اندازه کاشی‌ها */
    --gap: 6px;
  }
  @media (max-width: 768px){
    :root{ --tile: 30px; --gap: 4px; }
  }
  @media (max-width: 420px){
    :root{ --tile: 26px; --gap: 3px; }
  }

  *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, "Vazirmatn", Tahoma, Arial;
    display:flex; justify-content:center; align-items:stretch;
  }
  .app{width:100vw; max-width:720px; display:flex; flex-direction:column; padding:10px; gap:10px;}
  .top{ position:sticky; top:0; z-index:5; display:flex; flex-direction:column; gap:8px; background:linear-gradient(180deg, rgba(17,21,32,.95), rgba(17,21,32,.6)); backdrop-filter: blur(8px); padding-bottom:8px; }
  .stage{
    display:flex; justify-content:space-between; align-items:center; gap:8px; font-size:12px; color:var(--muted);
  }
  .controls{ display:flex; gap:8px; }
  button{ flex:1 1 auto; padding:10px 12px; border:0; border-radius:12px; font-weight:800; font-size:14px; cursor:pointer; }
  .btn-main{ background:linear-gradient(135deg, var(--accent), #ffd36a); color:#101217; }
  .btn-second{ background:linear-gradient(135deg, #a7b6cc, #e9eef7); color:#101217; }
  .btn-ghost{ background:transparent; color:var(--text); border:1px solid rgba(255,255,255,.14); }
  .btn:disabled, button:disabled{ opacity:.5; filter:grayscale(.3); }

  .grid{ 
    display:grid; gap:var(--gap);
    grid-template-columns: repeat(auto-fill, minmax(var(--tile), 1fr));
    background:#0f1420; border:1px solid rgba(255,255,255,.06); border-radius:14px; padding:8px; 
    overflow:auto; -webkit-overflow-scrolling: touch; 
    height:calc(100svh - 160px); /* فضای باقی‌مانده برای موبایل */
  }
  /* کاشی عددها */
  .num{
    position:relative; height:var(--tile); border-radius:10px; border:0; cursor:pointer; font-weight:900;
    font-size: clamp(9px, 2.6vw, 13px); letter-spacing:.2px;
    display:grid; place-items:center; color:#0d0f14;
    background: conic-gradient(from 180deg at 50% 50%, 
      hsl(var(--h) 85% 64%) 0 20%,
      hsl(calc(var(--h) + 30) 85% 62%) 20% 40%,
      hsl(calc(var(--h) + 60) 85% 64%) 40% 60%,
      hsl(calc(var(--h) + 90) 85% 62%) 60% 80%,
      hsl(var(--h) 85% 64%) 80% 100%);
    box-shadow: 0 0 0 1px rgba(255,255,255,.05) inset, 0 2px 10px rgba(0,0,0,.35);
    transition: transform .08s ease, filter .18s ease, outline-color .2s ease;
  }
  .num:active{ transform: scale(.97); }
  .num.active{ outline:3px solid rgba(255,255,255,.85); filter:saturate(1.2) contrast(1.1); }
  .num.final{ outline:3px solid var(--ok); filter:saturate(1.25) contrast(1.2); }

  /* توست برای نمایش متن هر عدد با تپ */
  .toast{ position:fixed; inset-inline:0; bottom:10px; display:flex; justify-content:center; pointer-events:none; z-index:50; }
  .toast .bubble{ pointer-events:auto; background:rgba(20,25,38,.95); border:1px solid rgba(255,255,255,.08); padding:9px 12px; border-radius:10px; font-size:13px; }

  /* مودال نتیجه نهایی */
  .overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:60;
    background: radial-gradient(50% 60% at 50% 40%, rgba(40,199,111,.18), rgba(17,21,32,.6)),
                rgba(10,12,18,.55); backdrop-filter: blur(6px); }
  .overlay.open{ display:flex; }
  .modal{ width:min(92vw, 560px); background:linear-gradient(180deg, #141b2a, #101622); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:18px; text-align:center;
    box-shadow: 0 10px 50px rgba(0,0,0,.6); transform: scale(.86); opacity:0; animation: pop .45s cubic-bezier(.2,1.2,.2,1) forwards; }
  @keyframes pop{ to{ transform:scale(1); opacity:1; } }
  .modal h2{ margin:6px 0 10px; font-size:22px; }
  .modal p{ margin:0 0 12px; line-height:1.7; font-weight:700; }
  .modal .actions{ display:flex; gap:8px; }
  .modal .actions button{ flex:1 1 auto; padding:10px; border-radius:12px; border:0; font-weight:800; }
  .modal .ok{ background:linear-gradient(135deg, var(--ok), #9dffa8); color:#07110a; }
  .modal .again{ background:transparent; border:1px solid rgba(255,255,255,.14); color:var(--text); }

  /* کانفیetti */
  .confetti-piece{
    position:fixed; top:-10vh; width:6px; height:10px; opacity:0.9; z-index:70; will-change: transform, opacity;
    animation: fall linear forwards;
  }
  @keyframes fall {
    to { transform: translateY(120vh) rotate(720deg); opacity: 1; }
  }
</style>
</head>
<body>
  <div class="app" id="app">
    <div class="top">
      <div class="stage">
        <div id="stageLabel">مرحله: ۱ / ۲</div>
        <div id="countLabel"></div>
      </div>
      <div class="controls">
        <button id="randomBtn" class="btn btn-main">انتخاب رندوم</button>
        <button id="nextBtn" class="btn btn-second" disabled>مرحله بعد</button>
        <button id="resetBtn" class="btn btn-ghost">شروع مجدد</button>
      </div>
    </div>

    <div id="grid" class="grid" aria-live="polite" aria-busy="false"></div>
  </div>

  <div class="toast" id="toast" style="display:none"><div class="bubble" id="toastText"></div></div>

  <!-- Modal -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="resTitle" aria-describedby="resText">
    <div class="modal">
      <h2 id="resTitle">هورا! 🎉</h2>
      <p id="resText"></p>
      <div class="actions">
        <button class="ok" id="closeModal">باشه</button>
        <button class="again" id="againBtn">شروع مجدد</button>
      </div>
    </div>
  </div>

<script>
const PLACES = ["کافه دنج محلی", "کافه پشت‌بامی", "کتابفروشی مستقل", "گالری هنری", "موزه هنر معاصر", "موزه علم و فناوری", "آسمان‌نما (پلانتاریوم)", "رصدخانه", "سینمای کلاسیک", "سینمای درایو-این", "تئاتر بداهه", "سالن کارائوکه", "کنسرت کوچک", "کافه بازی‌های رومیزی", "اتاق فرار", "آرکید بازی قدیمی", "پارک شهری بزرگ", "پارک جنگلی", "باغ گیاه‌شناسی", "باغ پرندگان", "آکواریوم", "باغ‌وحش", "شهربازی", "پیست اسکیت روی یخ", "پیست اسکیت‌برد", "بولینگ‌سنتر", "زمین مینی‌گلف", "سالن بیلیارد", "باشگاه تیراندازی با کمان", "سالن صخره‌نوردی", "مسیر کنار رودخانه", "ساحل دریا/دریاچه", "اسکله", "دریاچه قایق‌سواری", "قایق پدالی‌کرایه", "کایاک/کانوی‌کرایه", "بندرگاه قدیمی", "ایستگاه قطار تاریخی", "محله تاریخی", "خانه‌موزه", "بازارچه محلی", "بازار شبانه", "فودمارکت خیابانی", "کارگاه شکلات‌سازی", "آبجوسازی/نوشیدنی‌سازی", "روستری قهوه", "بستنی‌سازی محلی", "نانوایی هنری", "کلاس آشپزی", "مدرسه رقص", "استودیو سفالگری", "نقاشیِ پاشیدنی (اسپلش آرت)", "استودیوی عکاسی", "فروشگاه ساز و تست‌رووم", "نمایشگاه فناوری", "نمایشگاه کتاب", "نمایشگاه خودرو کلاسیک", "نمایشگاه صنایع‌دستی", "نمایشگاه گل و گیاه", "مزرعه آفتابگردان/لاله", "مزرعه چیدن میوه", "مزرعه اسب", "پناهگاه حیوانات", "پارک آبی", "استخر روباز", "سونا و اسپا", "چشمه آب‌گرم", "مسیر کوه‌پیمایی", "نقطه تماشای غروب", "بام پارکینگ با ویو", "ریل قدیمی‌ـ‌پارک خطی", "غار آهکی", "پارک دایناسور ماکتی", "موزه خطای دید", "خانه وارونه", "هزارتوی آینه", "سیرک مدرن", "جشنواره خیابانی", "بازار کریسمس/موسمی", "سینمای روباز", "کمپینگ‌سایت", "کلبه جنگلی", "رستوران گردان", "«غذا در تاریکی»", "بار مخفی (Speakeasy)", "خانه چای سنتی", "کافه حیوانات", "برکه پرنده‌نگری", "اسکای‌پارک/پل معلق", "زیپ‌لاین پارک", "پیست کارتینگ", "لانچ‌سایت بالون هوای‌گرم", "فرودگاه کوچک تفریحی", "موزه هوانوردی", "موزه ریاضیات", "تالاب", "پارک ملی", "جزیره نزدیک شهر", "کتابخانه مرکزی", "مرکز نجوم", "کوهستان با تله‌کابین", "پیست برف/برف‌بازی", "پیست اسکی/اسنوبرد", "آیس‌بار/یخ‌کافه", "باغ زمستانی/گرین‌هاوس", "باغ ژاپنی", "پارک موضوعی تاریخی", "پارک مجسمه‌ها", "دیوار گرافیتی/خیابان هنر", "کوچه‌پس‌کوچه عکاسانه", "پل عابرِ فتوژنیک", "فانوس‌دریایی", "اسکله ماهی‌گیری", "بازار ماهی", "قایق‌سواری کانال", "تور قایق شهری", "کشتی تفریحی رودخانه", "کشتی عصرگاهی با موزیک", "میدان فواره‌ها", "باغ‌راه نورانی شبانه", "پارک لاله‌گُل بهاری", "باغ رز", "جنگل مه‌آلود", "نقطه آسمان‌تاریک (ستاره‌بینی)", "پارک شهاب‌سنگ‌نگری", "اردوگاه ساحلی", "آلاچیق ساحلی", "بازار کشاورزان", "بازارچه قدیمی/عتیقه", "سمساری بزرگ", "فروشگاه وینیل/موسیقی", "فروشگاه کمیک", "فروشگاه بازی/فیگور", "کانسپت‌استور دیزاین", "اوتلت‌مال", "مرکز خرید شیک", "فروشگاه کتاب دست‌دوم", "کافه‌کتاب", "ورک‌اسپیس/کوورکینگ", "لابی هتل بوتیک", "کلوپ کتابخوانی محلی", "سالن اپرا", "سالن سمفونیک", "تئاتر موزیکال", "کلاب استندآپ کمدی", "نایت‌مارکت غذا", "فستیوال فیلم", "فستیوال موسیقی", "فستیوال نور/لنترن", "فستیوال بادبادک", "فستیوال شکلات/قهوه", "فستیوال بیگ‌ایتز/فودتراک", "موزه تاریخ محلی", "موزه مردم‌شناسی", "موزه سینما", "موزه عکاسی", "موزه عروسک/اسباب‌بازی", "موزه موم", "موزه سکه/تمبر", "موزه راه‌آهن", "موزه دریانوردی", "موزه پزشکی", "مرکز علوم تعاملی", "خانه معما/پازل", "سالن لیزرتگ", "زمین پینت‌بال", "ترامپولین‌پارک", "پارک طناب‌هوایی", "میدان بول‌پتانک/بوچیا", "باشگاه پینگ‌پنگ", "زمین بدمینتون", "اسکواش‌کلاب", "زمین تنیس", "پیست دوچرخه شهری", "مسیر دوچرخه ساحلی", "پارک اسکیت رولر", "پیست موتور چهارچرخ", "مسیر آفرود تفریحی (مجوزدار)", "مزرعه لاوندر", "باغ گیلاس/شکوفه", "باغ پرتقال/مرکبات", "مزرعه زیتون", "تاکستان/واینری", "کارگاه روغن‌گیری زیتون", "کارخانه عرقیات گیاهی", "بازار پارچه/طراحان", "بازار طلا و جواهر", "بازار خشکشویی عتیقه (Vintage)", "کارگاه چاپ سیلک/لترپرس", "کارگاه شیشه‌گری", "کارگاه نجاری هنری", "کارگاه فلزکاری هنری", "میکرواسپیس/میکرسیتی", "هکر‌اسپیس/فب‌لب", "باشگاه رباتیک/نمایش", "مرکز بازی‌های VR/AR", "اتاق موسیقی/جَم سشن", "استودیوی ضبط خانگیِ کرایه‌ای", "کلاس زبان/میلیتینگ", "باشگاه مناظره/سخنوری", "کلاس خوشنویسی", "کارگاه کمیک‌سازی", "کارگاه نویسندگی خلاق", "کارگاه عکاسی خیابانی", "کارگاه تدوین ویدئو", "کارگاه عطرسازی", "کارگاه شمع‌سازی", "کارگاه صابون‌سازی", "بازار گل", "نمایشگاه حیوانات خانگی", "مسیر پرنده‌نگری تالابی", "پارک ملی کویری", "رصد شهاب‌باران در بیابان", "پیک‌نیک‌سایت کوهستانی", "محوطه آتش مجاز", "باغ صخره‌ای", "باغ کاکتوس", "باغ بامبو", "باغ رمانتیک با آلاچیق", "باغ اروتیک آرت (غیرصریح)", "خانه تاریخی با حیاط", "میدان قدیمی شهر", "برج ساعت", "عمارت فرهنگ‌سرا", "تالار شهر/تور معماری", "پست‌خانه تاریخی", "موزه پست و مخابرات", "موزه ساعت", "موزه کارتون/کاریکاتور", "موزه مد و لباس", "موزه فرش/نساجی", "موزه خط/کتابت", "موزه فناوری‌های نو", "مرکز نوآوری/استارتاپ‌ها", "کافه روباتی", "سالن شبیه‌ساز پرواز", "سکو تماشای هواپیما", "ترمینال قدیمی/معماری", "ایستگاه تراموای قدیمی", "تله‌کابین شهری", "باغ‌راه‌روی رودخانه", "اسکله قایق رانی شبانه", "نورپردازی پل تاریخی", "خیابان نئون/تابلوها", "کوچه چراغانی", "کوچه بازار خوراک", "پاساژ قدیمی سقف‌شیشه‌ای", "کافه حیوانات نجات‌یافته", "باغ پروانه‌ها", "خزندگان/تراریوم", "مرکز اسب‌درمانی/پیاده‌سواری", "مرکز دوچرخه‌سواران شبانه", "آلاچیق‌های کوهستانی", "ایستگاه دیدبانی جنگل", "سکو ساحلی تماشای موج", "آکواپارک سرپوشیده", "حمام سنتی/حمام‌خانه", "اتاق نمک/هالوتراپی", "فلوت‌تَنک (حس‌زدایی)", "یوگااستودیو/سالن مدیتیشن", "استودیوی ساندبَث/کاسه تبتی", "کلاس تنفس/آیس‌بت", "پارک سگ‌ها (تماشا و نوازش)", "مزرعه لاما/آلپاکا", "باشگاه تیراندازی بادی", "مزرعه پرورش ماهی (صید تفریحی)", "اسکله قایق بادبانی", "باشگاه بادبادک‌بازان", "رصدخانه خورشیدی", "خانه قدیمی بازسازی‌شده (کافه)", "حیاط‌خلوت‌های هنری", "بازار نوشیدنی‌های محلی", "پاسیوهای رمانتیک شهری", "پیاده‌راه موسیقی‌زنده", "باغ‌موزه (فضای باز)", "مرکز هنری چندرسانه‌ای", "سالن واقعیت ترکیبی", "گنبد شیشه‌ای باغ", "لانژ بام‌هتل", "استخر بام", "ساحل شنی مصنوعی", "ساحل سنگی خلوت", "پناهگاه صخره‌ای ساحل", "آبشار کوتاه شهری", "دره کوچک اطراف شهر", "دشت گل‌های وحشی", "جنگل بلوط/راش", "تپه‌های شنی", "دریاچه نمک", "اسکای‌لاین‌پوینت شبانه", "کلبه ساحلی اجاره‌ای", "اقامتگاه بوم‌گردی", "روستای پلکانی", "کاروانسرا/رباط تاریخی", "آب‌انبار تاریخی", "بادگیر/خانه قاجاری", "موزه خط و مُهر", "پیاده‌راه رودخانه زیرزمینی (تور)", "مسیر ریلی دوچرخه‌ای", "محوطه نمایش خیابانی ثابت"];
const TODOS  = ["پیک‌نیک ساده در پارک", "پیاده‌روی شبانه و ستاره‌بینی", "دوچرخه‌سواری شهری", "قایق پدالی دونفره", "کایاک آرام", "اسکیت یا یادگرفتنش", "بولینگ با شرط خنده‌دار", "مینی‌گلف با قوانین خودتون", "حل اتاق فرار", "تجربه VR داستانی", "بازی رومیزی دونفره", "ماراتن آرکید", "کلاس آشپزی مشترک", "پخت پیتزای خانگی", "ساخت کوکتل/ماکتیل اختصاصی", "تست قهوه و نوت‌برداری", "تست شکلات/پنیر", "ساخت شکلات دست‌ساز", "سفالگری و ساخت ماگ جفتی", "نقاشی با چشم‌بند", "نقاشی روی بوم دونفره", "عکاسی پرتره و ادیت", "ساخت اسکرپ‌بوک", "نوشتن نامه‌های عاشقانه آینده", "ساخت پلی‌لیست دونفره", "رقص سالسا/بچاتا", "یادگیری وُلتز در خانه", "کلاس بوکس تفریحی", "یوگای زوجی (Partner)", "ماساژ آرام نوبتی (با مرزها)", "تور موزه‌ای با بازی «راهنما/توریست»", "شکار گرافیتی شهری", "تور معماری با تم", "رصد ماه با اپ", "تماشای غروب و نوشتن حس‌ها", "یادگیری صورت‌های فلکی", "فیلم کلاسیک + پاپ‌کورن", "بینج یک مینی‌سریال", "کارائوکه دونفره", "شعرخوانی و دکلمه", "بداهه‌نمایی کوتاه", "بازی حقیقت‌وجرأت (بالغانه و محترمانه)", "آزمون طعم‌ها با چشم‌بند", "طراحی سفر رؤیایی", "چالش ۳۰روزه مشترک", "پازل هزار‌تکه", "ساخت لگو/مدل", "باغبانی در گلدان", "کاشت بذر و نامگذاری", "غذا دادن به پرندگان (مجاز)", "داوطلبی کوتاه در پناهگاه حیوانات", "پیک‌نیک شبانه با ریسه", "کباب مارشملو کنار آتش مجاز", "اسکوتر برقی‌گردی", "کارتینگ دوستانه", "زیپ‌لاین/های‌روپس", "کوه‌پیمایی سبک", "چیدن میوه از مزرعه", "اسب‌سواری آرام", "آب‌تنی/پارک آبی", "سونا و ریلکس", "فستیوال غذایی", "کافه‌گردی سه‌مرحله‌ای", "تست دم‌نوش‌ها", "ساخت شمع/عطر", "نامه‌نگاری یک‌شبی ناشناس", "«دو حقیقت و یک دروغ»", "نقش‌آفرینی سبک و خنده‌دار", "ترفندهای بارتندینگ", "ساخت و پرواز بادبادک", "طراحی تی‌شرت چاپ‌دستی", "کارگاه خوشنویسی/لترینگ", "تور کتابفروشی", "بلندخوانی یک فصل", "شکار گنج شهری", "چالش عکاسی ۱۰موضوعی", "تور خوراکی سه‌مرحله‌ای", "پیک‌نیک روی پشت‌بام", "ساخت پادکست ۱۰دقیقه‌ای", "ضبط ویدئوی رقص خصوصی", "ماسک صورت و سلف‌کیِر", "چشایی کورِ میوه/آبمیوه", "تمرین زبان خارجی", "بازسازی «اولین دیت» خیالی", "نوشتن داستان کوتاه مشترک", "نقشه علایق و مرزها (رابطه سالم)", "طراحی آیین‌های روزانه", "ساخت جعبه «کارت‌های قرار»", "لیست آرزوهای مشترک", "کارت‌پستال برای آینده", "هدیه‌های کوچک با بودجه محدود", "گردش بی‌هدف با مترو/اتوبوس", "عکاسی فقط سیاه‌وسفید", "بازی ویدئویی Co-op", "شطرنج/چکرز در پارک", "کوییزنایت/Trivia", "پخت کوکی و تزیین رقابتی", "چشیدن غذاهای عجیب", "پلی‌لیست «ترانه‌های زندگی»", "کارت‌های گفت‌وگوی عمیق", "اسکچ‌نوت خاطرات هفته", "ساخت موک‌تیل فصلی", "ساخت ترشی/سس خانگی", "تست بستنی‌های عجیب", "تِیستینگ نان‌های محلی", "ساخت صبحانه تخت‌خواب", "بریک‌فست پیک‌نیک طلوع", "پخت پنکیک دونفره", "چالش «کم‌مصرف/کم‌پلاستیک»", "تعمیر یک چیز قدیمی با هم", "DIY قفسه کوچک", "نقاشی مبلمان کهنه", "ساخت گلدان سیمانی", "ساخت آباژور ساده", "ساخت قاب‌عکس دست‌ساز", "مونتاژ پازل عکس مشترک", "چاپ عکس‌های فوری و دیوار خاطره", "اجرای مینی‌کنسرت خانگی", "تمرین یک ساز جدید", "آوازخوانی یادگاری", "ساخت تیک‌تاک/ریل خلاق", "تقلید سکانس فیلم محبوب", "دوبله طنز یک کلیپ", "ساخت میم مشترک", "ژورنال‌نویسی دونفره", "تمرین مدیتیشن هدایت‌شده", "تنفس جفتی 4-7-8", "یوگای ریلکس شبانه", "پیاده‌روی توجه‌آگاهی", "چای بعدازظهر تشریفاتی", "بازی «اگر…؟»", "طراحی پرچم زوج‌تان", "نقشه رؤیاهای ده‌ساله", "آلبوم «اولین‌ها» بسازید", "فهرست سطل‌لیست مشترک", "نقشه غذاییِ شهر", "برنامه «بدون موبایل» ۳ساعت", "گردش با دوربین آنالوگ", "ساخت گیف‌های بامزه", "اسلوموشن بادکنک آب", "چالش ۵۰۰۰ قدم حرف‌زدن", "اتاق را نورِ ریسه‌ای کنید", "پیک‌نیک داخل خانه", "تماشای باران پشت پنجره", "ساخت قلعه بالش‌ها", "نبرد بالش (ملایم)", "بازی اسم‌فامیل دونفره خلاق", "حل جدول/سودوکو با هم", "چالش نقاشی ۵دقیقه‌ای", "نوشتن هایکو برای هم", "ساخت کارت تبریک دست‌ساز", "اوریگامی دونفره", "ساخت جعبه یادگاری", "سفارشی‌سازی کفش/لباس", "ساخت زیور دست‌ساز", "طراحی تاتو موقت", "نقاشی بدن با رنگ بی‌خطر", "بازی نقش‌آفرینی فانتزیِ توافقی", "تمرین رقص کُریو از یوتیوب", "یادگیری تانگوِ نزدیک (با رضایت)", "عکاسی سیلوئت در غروب", "تایم‌لپس آسمان شب", "شکار شهاب‌سنگ با پتو", "ساخت نقشه آسمانِ شب آشنایی‌تان", "بازی «جستجوی بوی عطر»", "تست عطر روی پوست هم", "خرید لباس برای هم (چالش)", "استایلینگ و فشن‌شو خانگی", "عکاسی فشنِ خلاق", "تست کلاه‌گیس/اکسسوری فان", "میکاپ هنری روی هم", "آموزش بافت مو/استایل", "پیاده‌روی حیوان‌دوستانه", "داوطلبی رویداد فرهنگی", "نقشه‌برداری کافه‌های جدید", "دونات‌گردی", "بستنی‌گردی", "قهوه‌گردی", "تِی‌تِستینگ رسمی", "تور نان/پاتیسری", "ساخت باکس «قرارهای آینده»", "کارت‌های «تعطیلات بدون خرج»", "برنامه‌ریزی سفر کوتاه", "بررسی محله‌های رؤیایی", "نوشتن لیست «نه‌ها و بله‌ها»", "مرور ارزش‌ها و مرزها", "تمرین گفت‌وگوی صمیمانه ساختاری", "بازی «مکث و گوش‌دادن»", "تعریف قصه‌های کودکی", "ساخت شجره علایق", "جمع‌آوری سنگ/برگ یادگاری", "تراریوم کوچک بسازید", "کاشت سبزی خوردن", "ساخت مزرعه قارچ کوچک", "ساخت باغچه عمودی", "طراحی منوی هفته", "آشپزی ملل (هر بار یک کشور)", "شِف‌وار تست کور", "چالش «۵ماده اولیه»", "چالش «زشت‌ترین ساندویچ خوشمزه»", "ماساژ حسی کف دست/سر (رضایت‌محور)", "ماساژ پا/شانه (با مرزهای روشن)", "حمام حبابی دونفره (غیرصریح)", "عطر زدن برای هم", "بوسه‌های طولانیِ رضایتمندانه", "رقص خصوصی آهسته", "تماشای باران از زیر یک پتو", "شام شمعی در خانه", "نوشتن یادداشت‌های شیطنت‌آمیز محترمانه", "بازی کارت «سؤالات صمیمیِ بزرگسال»", "بازی «حدس لمس» با چشم‌بند (غیرصریح)", "تست خوراکی روی پوستِ دست (غیرصریح)", "طراحی قرارداد رضایت و سیف‌ورد", "ساخت پلی‌لیست «حسّی و آرام»", "نقش‌آفرینیِ رمانتیکِ توافقی", "بداهه‌رقص با نور کم", "عکاسی بُدوآر محترمانه (بدون نمایش صریح)", "نقاشی بدن با قلم‌مو (غیرصریح)", "ساخت کوکتل‌های «گرم‌کن حس» بدون الکل", "ماسک پارافین دست و گفت‌وگو", "سایش ملایم پشت‌دست‌ها (ریلکس)", "تمرین «نگاه‌کردنِ ۲ دقیقه‌ای»", "هم‌تنفسی آرام روی موزیک", "نوشتن فانتزی‌های مورد رضایت (بدون جزئیات)", "چالش «تعریف جذاب‌ترین ویژگی هم»", "بازی «تعریف سه چیز جذاب امروز»", "طراحی لباس خواب شیک (غیرصریح)", "خرید/انتخاب عطر بدن دلخواه", "چای‌درمانی و حرف‌های جسورانه محترمانه", "ساخت شمع معطرِ «امضای شما»", "برنامه «لمسِ دست‌ها فقط» (حس‌آموز)", "تمرین «قدردانی بدنیِ غیرصریح»", "رقص سایه پشت پرده (هنری)", "آلبوم عکس‌های «تنها دست‌ها و نگاه‌ها»", "بازی «تعریف مرزهای راحتی»", "طراحی «شب بدون صفحه‌نمایش»", "نوشتن «ده کار صمیمی غیرصریح»", "پیک‌نیک اتاق‌نشیمن با نور کم", "چالش «آرام‌ترین نوازش مو»", "تمرین «اسم رمزِ توقف/ادامه»", "استریپ‌پوکِر شیک و محترمانه (رضایتمندانه، غیرصریح)", "رقص دور میله خیالی (شو فان، غیرصریح)", "آموزش قدم‌های رقص اروپایی", "ماساژ با سنگ داغ دست‌ساز (ایمن)", "حمام پا دونفره", "آروماتراپی خانگی", "مدیتیشن هدایت‌شده برای صمیمیت", "تمرین «گوش دادنِ فعال در آغوش»", "نوشتن «پلی‌لیست بوسه»", "بازی «نامه‌های رمزآلود یک‌شبه»", "ساخت صندوقچه رازهای مشترک", "ساخت شیشه «دلایل دوست‌داشتن»", "برنامه «تعویض استایل»", "خرید لباس برای هم (با سقف بودجه)", "پروژه اتاق رمانتیک (نور و عطر)", "طراحی کارت‌های قرار سکسی غیرصریح", "نواختن موزیک ملایم زنده", "بداهه‌خوانی نجواگونه", "بازی «چشیدن میوه با چشم‌بند»", "ساخت بستنی لقمه‌ای روی هم", "کوکتل شکلات داغ ادویه‌ای", "چالش «آهسته‌خوری»", "غذا دادن لقمه‌ای (غیرصریح)", "نوشتن «فهرست خاموش‌کننده‌ها/روشن‌کننده‌ها»", "بازی «آینه» (حرکت همزمان)", "تمرین «هم‌زمان‌سازی ضربان با آغوش»", "پیژامه‌پارتی شیک", "ساخت لباس‌خواب DIY (غیرصریح)", "رقص روی فرش با جوراب", "نقاشی لب‌ها روی کاغذ و امضا", "ساخت اسپری ملحفه خوشبو", "تمرین «کند راه‌رفتنِ همزمان»", "فال تاروت عاشقانه فان", "بازی «سؤالِ ممنوع» با پاس", "مسابقه تعریف جذابیت‌های روز", "ساخت پلاک اسم یا دستبند جفتی", "نوشتن سوگندهای بامزه", "ساخت مانترای زوج", "تمرین «به چشم هم نگاه کردن و گفتن یک جمله»", "تمرین «تشکر بدنی غیرصریح»", "برنامه «شامِ آهسته + موزیک + نور کم»", "نقاشی روی آینه حمام (قلب‌ها)", "نوشتن پیام‌های چسبان عاشقانه در خانه", "ساخت بازی کارتی مخصوص خودتان", "ضبط پیام صوتی «چرا جذابی»", "ساخت ویدئوی سالگرد خیالی", "نقشه‌برداری «لوکیشن‌های بوسه» (علنی نباشد)", "تور «سه مکان آرام برای نجوا»", "نوشتن «پنج رؤیای مشترک»", "پیاده‌روی در باران با یک چتر", "گوش دادن به وینیل رمانتیک", "تماشای آتش شومینه/شمع", "ساخت کوکی قلبی", "بازی «کلمات امن/ممنوع امشب»", "ساخت جعبه «دِیت‌های سکسیِ غیرصریح»", "تمرین «لمس mindful روی دست/بازو»", "طراحی «کُریو رقص آهسته خصوصی»", "نقش‌آفرینی «قرار اول از نو»", "ساخت «کتابچه مرزها و علایق»", "جشن کوچک «پیشرفت صمیمیت» با هدیه نمادین"];

let stage = 1; // 1 = مکان، 2 = کار
let selectedPlace = null;
let selectedTodo  = null;
let animRunning = false;

const DOM = {
  grid: document.getElementById('grid'),
  randomBtn: document.getElementById('randomBtn'),
  nextBtn: document.getElementById('nextBtn'),
  resetBtn: document.getElementById('resetBtn'),
  stageLabel: document.getElementById('stageLabel'),
  countLabel: document.getElementById('countLabel'),
  toast: document.getElementById('toast'),
  toastText: document.getElementById('toastText'),
  overlay: document.getElementById('overlay'),
  resText: document.getElementById('resText'),
  closeModal: document.getElementById('closeModal'),
  againBtn: document.getElementById('againBtn'),
};

function currentList(){ return stage===1 ? PLACES : TODOS; }

function buildGrid(){
  const data = currentList();
  DOM.grid.innerHTML = '';
  const n = data.length || 0;
  for(let i=0;i<n;i++){ 
    const b = document.createElement('button');
    b.className = 'num';
    const hue = Math.round((i/n)*360);
    b.style.setProperty('--h', hue);
    b.textContent = (i+1).toLocaleString('fa-IR');
    b.dataset.index = i;
    b.addEventListener('click',()=>showText(i));
    DOM.grid.appendChild(b);
  }
  DOM.countLabel.textContent = (n).toLocaleString('fa-IR') + ' مورد';
  DOM.stageLabel.textContent = 'مرحله: ' + (stage===1 ? '۱' : '۲') + ' / ۲';
}

function showToast(msg, ms=2800){
  DOM.toastText.textContent = msg;
  DOM.toast.style.display='flex';
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=> DOM.toast.style.display='none', ms);
}

function showText(idx){
  const text = currentList()[idx];
  showToast('«'+ text +'»');
}

// رولت انتخاب رندوم با افکت چرخش بین اعداد
function randomBetween(min, max){ return Math.random()*(max-min)+min; }

async function runRoulette(){
  if(animRunning) return;
  const data = currentList();
  const n = data.length;
  if(n===0) return;

  animRunning = true;
  DOM.grid.setAttribute('aria-busy','true');
  DOM.randomBtn.disabled = true;
  DOM.nextBtn.disabled = true;
  DOM.resetBtn.disabled = true;

  const duration = Math.round(randomBetween(3000, 10000)); // 3 تا 10 ثانیه
  let t0 = performance.now();
  let idx = Math.floor(Math.random()*n);
  let prevEl = null;
  const easeOutCubic = x => 1 - Math.pow(1 - x, 3);

  const finalIdx = await new Promise(resolve => {
    const step = () => {
      const now = performance.now();
      const elapsed = now - t0;
      const p = Math.min(1, elapsed/duration);
      const baseDelay = 16; // سریع‌تر برای موبایل
      const dly = baseDelay + easeOutCubic(p)*180;

      idx = (idx + 1) % n;
      if(prevEl) prevEl.classList.remove('active');
      const el = DOM.grid.children[idx];
      el.classList.add('active');
      prevEl = el;

      if(p >= 1) {
        // ایندکس نهایی بصورت رندوم برای عدالت
        const k = Math.floor(Math.random()*n);
        if(prevEl) prevEl.classList.remove('active');
        const fel = DOM.grid.children[k];
        fel.classList.add('final');
        fel.scrollIntoView({block:'center', inline:'center', behavior:'smooth'});
        resolve(k);
        return;
      }
      setTimeout(step, dly);
    };
    step();
  });

  const picked = data[finalIdx];
  showToast('«'+ picked +'»');

  if(stage===1){
    selectedPlace = picked;
    DOM.nextBtn.disabled = false;
  } else {
    selectedTodo = picked;
    // نمایش مودال نتیجه با افکت و کانفیetti
    DOM.resText.textContent = 'محل «' + selectedPlace + '» انتخاب شد و باید «' + selectedTodo + '» انجام بدیم.';
    openModal();
    fireConfetti(140);
  }

  animRunning = false;
  DOM.grid.removeAttribute('aria-busy');
  DOM.randomBtn.disabled = false;
  DOM.resetBtn.disabled = false;
}

function goNext(){
  if(stage===1 && selectedPlace){
    stage = 2;
    buildGrid();
    DOM.nextBtn.disabled = true;
    DOM.grid.scrollTo({top:0, behavior:'smooth'});
  }
}

function resetAll(){
  stage = 1;
  selectedPlace = null;
  selectedTodo = null;
  buildGrid();
  DOM.nextBtn.disabled = true;
  closeModal();
}

// مودال
function openModal(){
  DOM.overlay.classList.add('open');
  document.body.style.overflow='hidden';
}
function closeModal(){
  DOM.overlay.classList.remove('open');
  document.body.style.overflow='';
}

// کانفیetti ساده بدون کتابخانه
function fireConfetti(count=80){
  const colors = ['#ff4757','#ff6b81','#ffa502','#2ed573','#1e90ff','#70a1ff','#5352ed','#7bed9f','#ffe66d'];
  for(let i=0;i<count;i++) {
    const p = document.createElement('i');
    p.className = 'confetti-piece';
    const size = Math.random()*6 + 4;          // 4 تا 10px
    const left = Math.random()*100;            // درصد افقی
    const duration = Math.random()*1.5 + 1.8;  // 1.8 تا 3.3s
    const delay = Math.random()*0.25;
    const color = colors[Math.floor(Math.random()*colors.length)];
    p.style.width = (size*0.6)+'px';
    p.style.height = size+'px';
    p.style.left = left+'vw';
    p.style.background = color;
    p.style.animationDuration = duration+'s';
    p.style.animationDelay = delay+'s';
    p.style.transform = 'translateY(-10vh) rotate('+(Math.random()*360)+'deg)';
    p.style.borderRadius = (Math.random()>.6 ? '50%':'2px');
    document.body.appendChild(p);
    setTimeout(()=>p.remove(), (duration+delay)*1000 + 200);
  }
}

// رویدادها
DOM.randomBtn.addEventListener('click', runRoulette);
DOM.nextBtn.addEventListener('click', goNext);
DOM.resetBtn.addEventListener('click', resetAll);
DOM.closeModal.addEventListener('click', closeModal);
DOM.againBtn.addEventListener('click', ()=>{ resetAll(); });

// شروع
buildGrid();
</script>
</body>
</html>
