<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Masoud â¤ï¸ Pishul â€” Mobile Love Stats (No-Lib)</title>
<style>
  :root{
    --bg:#0e1016;--bg2:#11192a;--fg:#eef3ff;--muted:#9aa5bd;
    --acc1:#ff6bcb;--acc2:#6bd6ff;--acc3:#ffd36b;--acc4:#47d16c;--acc5:#b387ff;
    --card:rgba(255,255,255,.06);--glass:rgba(255,255,255,.07);--shadow:0 10px 24px rgba(0,0,0,.25);
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{height:100%}
  body{
    margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Vazirmatn",sans-serif;
    background:
      radial-gradient(600px 300px at 80% -10%, rgba(255,107,203,.25), transparent 60%),
      radial-gradient(500px 300px at -10% 90%, rgba(107,214,255,.22), transparent 60%),
      linear-gradient(180deg, var(--bg2), var(--bg));
    color:var(--fg);overflow-x:hidden;
  }
  header{position:sticky;top:0;z-index:10;padding:14px 12px 10px;background:linear-gradient(180deg, rgba(17,25,42,.9), rgba(17,25,42,.6), transparent)}
  .title{font-weight:800;letter-spacing:.3px;font-size:22px}
  .sub{opacity:.9;margin-top:4px;font-weight:600;font-size:13px}

  .container{max-width:560px;margin:0 auto;padding:10px 10px 56px}
  .card{background:var(--card);border-radius:14px;padding:12px;margin:10px 0;box-shadow:var(--shadow)}
  .card h3{margin:0 0 6px;font-size:15px}
  .hint{color:var(--muted);font-size:12px}

  .kpis{display:grid;grid-template-columns:1fr;gap:8px}
  .kpi{background:var(--glass);border-radius:12px;padding:10px;text-align:center}
  .kpi .num{font-size:20px;font-weight:800}

  .two-col{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:420px){ .two-col{grid-template-columns:1fr} }

  .pills{display:flex;flex-wrap:wrap;gap:6px}
  .pill{padding:8px 10px;border-radius:999px;background:var(--glass);font-size:13px}

  .emoji-cloud{display:flex;flex-wrap:wrap;gap:6px}
  .emoji-cloud .b{display:inline-flex;align-items:center;gap:6px;padding:6px 8px;border-radius:10px;background:var(--glass)}
  .emoji-cloud .e{font-size:18px}.emoji-cloud .c{font-size:11px;color:var(--muted)}

  .badge{padding:4px 8px;border-radius:999px;font-size:11px;font-weight:800}
  .b1{background:rgba(255,107,203,.18)} .b2{background:rgba(107,214,255,.18)}

  /* canvas-less SVG box */
  .chart{width:100%;height:260px;background:var(--glass);border-radius:12px;padding:8px;display:flex;align-items:center;justify-content:center}
  .legend{display:flex;gap:10px;flex-wrap:wrap;font-size:12px;margin-top:6px}
  .dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-left:6px;vertical-align:middle}
  .lg-m{background:var(--acc2)} .lg-p{background:var(--acc1)} .lg-y{background:var(--acc3)} .lg-g{background:var(--acc4)} .lg-v{background:var(--acc5)}

  table{width:100%;border-collapse:collapse;border-radius:10px;overflow:hidden}
  th,td{padding:9px;border-bottom:1px dashed rgba(255,255,255,.08)}
  th{text-align:right;color:var(--muted);font-weight:700;font-size:12px}
  tbody tr:hover{background:rgba(255,255,255,.05)}

  /* tiny hearts */
  .float-hearts{pointer-events:none;position:fixed;inset:0;overflow:hidden}
  .heart{position:absolute;opacity:.10;animation:rise 11s linear infinite}
  .heart:before{content:"â¤ï¸";font-size:16px;display:block}
  @keyframes rise{from{transform:translateY(100vh) scale(.8)}to{transform:translateY(-10vh) scale(1.1)}}

  .debug{white-space:pre-wrap;font-family:ui-monospace,Consolas,monospace;background:#281b1b;color:#ffb3b3;padding:10px;border-radius:10px;margin-top:8px;display:none}
</style>
</head>
<body>
  <div class="float-hearts" id="hearts"></div>
  <header>
    <div class="title">Masoud â¤ï¸ Pishul â€” Our Chat Story</div>
    <div class="sub">Ø§Ø² <b id="dr1">â€”</b> ØªØ§ <b id="dr2">â€”</b> â€” <span id="days">â€”</span> Ø±ÙˆØ² Ø¨Ø§ <span id="total">â€”</span> Ù¾ÛŒØ§Ù…</div>
  </header>

  <main class="container">
    <section class="card">
      <h3>Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ</h3>
      <div class="hint">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†â€ŒÙ‡Ø§ Ø¨Ø§ ÙØ§ØµÙ„Ù‡ Ø³Ø´Ù† â‰¥Û¶Û° Ø¯Ù‚ÛŒÙ‚Ù‡</div>
      <div class="kpis">
        <div class="kpi"><div class="num" id="k_total">0</div><small>Ú©Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</small></div>
        <div class="kpi"><div class="num" id="k_sessions">0</div><small>ØªØ¹Ø¯Ø§Ø¯ Ø³Ø´Ù†â€ŒÙ‡Ø§</small></div>
        <div class="kpi"><div class="num" id="k_avgSess">0</div><small>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù…Ø¯Øª Ø³Ø´Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡)</small></div>
        <div class="kpi"><div class="num" id="k_dayAvg">0</div><small>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† Ø±ÙˆØ²Ø§Ù†Ù‡ (Ø¯Ù‚ÛŒÙ‚Ù‡)</small></div>
      </div>
    </section>

    <section class="card">
      <h3>Ù†Ù…ÙˆØ¯Ø§Ø± Ù¾Ø±ÙˆØ§Ù†Ù‡â€ŒØ§ÛŒ: Ø¹Ø´Ù‚ / Ø³Ø¤Ø§Ù„ / Ø¯Ø³ØªÙˆØ±ÛŒ / Ù…ÛŒÙ…</h3>
      <div class="chart"><svg id="svgTornado" width="100%" height="100%" viewBox="0 0 360 200" aria-label="tornado chart"></svg></div>
      <div class="legend">
        <span><i class="dot lg-m"></i>Masoud</span>
        <span><i class="dot lg-p"></i>Pishul</span>
      </div>
    </section>

    <section class="card">
      <h3>Ø´Ø±ÙˆØ¹â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ú¯ÙØªÚ¯Ùˆ</h3>
      <div class="hint">Ø¨Ø¹Ø¯ Ø§Ø² â‰¥Û¶Û° Ø¯Ù‚ÛŒÙ‚Ù‡ Ø³Ú©ÙˆØª â€” Ø±ÙˆØ² Ø±Ú©ÙˆØ±Ø¯Ø¯Ø§Ø±: <b id="recDay">â€”</b></div>
      <div class="chart"><svg id="svgDonut" width="100%" height="100%" viewBox="0 0 200 200" aria-label="donut chart"></svg></div>
    </section>

    <section class="card">
      <h3>ØªÙˆØ²ÛŒØ¹ Ø³Ø±Ø¹Øª Ù¾Ø§Ø³Ø®</h3>
      <div class="hint">Ø³Ø±ÛŒØ¹â€ŒØªØ± = Ø¨Ù‡ØªØ± ğŸ˜‰</div>
      <div class="chart"><svg id="svgReply" width="100%" height="100%" viewBox="0 0 360 200" aria-label="reply bars"></svg></div>
      <div class="legend">
        <span><i class="dot lg-m"></i>Masoud</span>
        <span><i class="dot lg-p"></i>Pishul</span>
      </div>
    </section>

    <section class="card">
      <h3>Ûµ Ø´Ø§Ø®Øµ Ø¨Ù‡â€ŒØ§Ø²Ø§ÛŒ Ù‡Ø± Û±Û°Û° Ù¾ÛŒØ§Ù…</h3>
      <div class="hint">Ù…Ø­Ø¨Øª / Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€Œ/Ù…ÛŒÙ… / Ø³Ø¤Ø§Ù„ / Ø¯Ø³ØªÙˆØ±ÛŒ / Ú©ÙˆØªØ§Ù‡</div>
      <div class="chart"><svg id="svgFive" width="100%" height="100%" viewBox="0 0 360 200" aria-label="five metrics"></svg></div>
    </section>

    <section class="card">
      <h3>ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±ØªÚ©Ø±Ø§Ø±</h3>
      <div class="hint">Top 10 Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù†ÙØ± â€” Ù…Ø±ØªØ¨ Ùˆ ØªÙ…ÛŒØ²</div>
      <div class="two-col">
        <div>
          <div class="badge b2" style="margin-bottom:6px">Masoud</div>
          <div class="pills" id="wordsMasoud"></div>
        </div>
        <div>
          <div class="badge b1" style="margin-bottom:6px">Pishul</div>
          <div class="pills" id="wordsPishul"></div>
        </div>
      </div>
    </section>

    <section class="card">
      <h3>Ø³Ù„Ø§Ù… Ùˆ Ø´Ø¨â€ŒØ¨Ø®ÛŒØ±</h3>
      <div class="hint">ØµØ¨Ø­/Ø´Ø¨ Ø¨Ù‡ ØªÙÚ©ÛŒÚ© + Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²/Ø´Ø¨</div>
      <div class="chart"><svg id="svgGreet" width="100%" height="100%" viewBox="0 0 360 200" aria-label="greet bars"></svg></div>
      <div class="hint" style="margin-top:6px">
        Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù… Ù‡Ø± Ø±ÙˆØ² â€” Masoud: <b id="lastDayM">â€”</b> | Pishul: <b id="lastDayP">â€”</b>
      </div>
      <div class="hint">Ø´Ø¨â€ŒÙ‡Ø§ (Û²Û²â€“Û°Û³) â€” Masoud: <b id="lastNightM">â€”</b> | Pishul: <b id="lastNightP">â€”</b></div>
    </section>

    <section class="card">
      <h3>ØªØ§ÛŒÙ… ØªØ§ÛŒÙ¾ Ùˆ Ø¢Ù†Ù„Ø§ÛŒÙ†</h3>
      <div class="hint">ØªÙ‚Ø±ÛŒØ¨ÛŒ ÙˆÙ„ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ</div>
      <div class="chart"><svg id="svgTime" width="100%" height="100%" viewBox="0 0 360 200" aria-label="time bars"></svg></div>
    </section>

    <section class="card">
      <h3>Emoji Cloud</h3>
      <div class="hint">Ù¾Ø±ØªÚ©Ø±Ø§Ø±Ù‡Ø§ÛŒ Ú©Ù„ Ú†Øª</div>
      <div id="emojiCloud" class="emoji-cloud"></div>
    </section>

    <section class="card">
      <h3>Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ù†ÙØ±</h3>
      <div class="hint">Ø§Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ù‚Ø¹ÛŒ</div>
      <div style="overflow:auto">
        <table id="detailTable">
          <thead>
            <tr>
              <th>Ù†ÙØ±</th><th>Ù¾ÛŒØ§Ù…</th><th>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù¾Ø§Ø³Ø®</th><th>Ù…Ø¯ÛŒÙ† Ù¾Ø§Ø³Ø®</th>
              <th>Ø§Ø¨Ø±Ø§Ø² Ø¹Ù„Ø§Ù‚Ù‡</th><th>ØªØ¹Ø±ÛŒÙ</th><th>Ø³Ø¤Ø§Ù„</th>
              <th>Ø¯Ø³ØªÙˆØ±ÛŒ</th><th>Ú©ÙˆØªØ§Ù‡</th><th>Ù…ÛŒÙ…/Ø´ÙˆØ®ÛŒ</th><th>ØµØ¨Ø­â€ŒØ¨Ø®ÛŒØ±</th><th>Ø´Ø¨â€ŒØ¨Ø®ÛŒØ±</th>
              <th>Ù…Ø­Ø¨Øª/Û±Û°Û°</th><th>Ø§ÛŒÙ…ÙˆØ¬ÛŒ/Û±Û°Û°</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <div id="dbg" class="debug"></div>
  </main>

<script>
(function(){
  // --- Hard data (Ø§Ø² ØªØ­Ù„ÛŒÙ„ Ú†Øª Ø´Ù…Ø§) ---
  var data = {
    participants:["Masoud","Pishul cute <3"],
    date_range:["2025-08-11","2025-09-30"],
    total_days:48,total_messages:14324,
    sessions:{count:172,avg_session_min:78.8,total_minutes:13548.3,avg_daily_min:282.3,initiations:{"Pishul cute <3":93,"Masoud":79}},
    record_day:{date:"2025-09-23",count:1124},
    last_msg_by_day_counts:{"Pishul cute <3":20,"Masoud":28},
    last_msg_at_night_counts:{"Pishul cute <3":22,"Masoud":24},
    typing_minutes_by_sender:{"Masoud":779.1,"Pishul cute <3":508.1},
    online_minutes_by_sender:{"Masoud":6657.3,"Pishul cute <3":6891.0},
    affection_index:{"Masoud":4.45,"Pishul cute <3":5.47},
    emoji_density:{"Masoud":17.93,"Pishul cute <3":30.88},
    reply_distribution:{
      "Masoud":{"<1m":2238,"1â€“5m":473,"5â€“60m":240,">60m":60},
      "Pishul cute <3":{"<1m":2272,"1â€“5m":472,"5â€“60m":188,">60m":78}
    },
    head:{
      "Masoud":{messages:7105,affection:174,imperative:1078,avg_reply_min:7.2,median_reply_min:0.3,questions:281,short_msgs:2628,morning:10,night:4,compliment:142,joke_meme:712},
      "Pishul cute <3":{messages:7219,affection:246,imperative:938,avg_reply_min:10.3,median_reply_min:0.3,questions:319,short_msgs:3219,morning:8,night:10,compliment:149,joke_meme:1203}
    },
    top_words_by_sender:{
      "Masoud":["Ø¯Ø§Ø±Ù…","Ù…ÛŒ","Ø¨Ø±Ø§","Ø¨Ø§ÛŒØ¯","Ú©Ù†","Ø®ÙˆØ¨","Ù…ÛŒÚ©Ù†Ù…","Ú©Ø±Ø¯Ù…","Ú©Ø§Ø±","ÙÚ©"],
      "Pishul cute <3":["Ø®ÙˆØ¨","Ø¯Ø§Ø±Ù…","Ø§Ø±Ù‡","Ù†ÛŒØ³Øª","Ù…Ù†Ù…","Ø¨ÙˆØ³","Ø¯ÙˆØ³Øª","Ø¨Ø§ÛŒØ¯","ÙÚ©Ø±","Ú©Ù†"]
    },
    emoji_top_overall:{"ğŸ˜‚":663,"ğŸ˜":165,"ğŸ˜¡":148,"ğŸ˜½":119,"ğŸ—£":111,"ğŸ˜­":79,"ğŸ¥¹":70,"ğŸ˜":65,"â¤":49,"â˜¹ï¸":46,"ğŸ§":40}
  };

  // --- helper: qs ---
  function qs(id){ return document.getElementById(id); }
  function numFA(n){ try{ return Number(n).toLocaleString('fa-IR'); }catch(e){ return String(n); } }

  // --- Hearts (pure CSS, minimal DOM) ---
  (function hearts(){
    var layer = qs('hearts');
    for(var i=0;i<12;i++){
      var h=document.createElement('div'); h.className='heart';
      h.style.left = (Math.random()*100)+'%';
      h.style.animationDelay = (Math.random()*-11)+'s';
      layer.appendChild(h);
    }
  })();

  // --- Header + KPIs ---
  qs('dr1').textContent = data.date_range[0];
  qs('dr2').textContent = data.date_range[1];
  qs('days').textContent = numFA(data.total_days);
  qs('total').textContent = numFA(data.total_messages);
  function animNum(el, val){
    var t0=performance.now(), dur=800;
    function tick(t){ var p=Math.min(1,(t-t0)/dur); el.textContent = numFA(Math.floor(val*p)); if(p<1) requestAnimationFrame(tick); }
    requestAnimationFrame(tick);
  }
  animNum(qs('k_total'), data.total_messages);
  animNum(qs('k_sessions'), data.sessions.count);
  animNum(qs('k_avgSess'), Math.round(data.sessions.avg_session_min));
  animNum(qs('k_dayAvg'), Math.round(data.sessions.avg_daily_min));

  // --- Words pills ---
  data.top_words_by_sender["Masoud"].forEach(function(w){ var d=document.createElement('div'); d.className='pill'; d.textContent=w; qs('wordsMasoud').appendChild(d); });
  data.top_words_by_sender["Pishul cute <3"].forEach(function(w){ var d=document.createElement('div'); d.className='pill'; d.textContent=w; qs('wordsPishul').appendChild(d); });

  // --- Emoji cloud ---
  (function(){
    var cloud = qs('emojiCloud');
    var vals = Object.values(data.emoji_top_overall);
    var max = Math.max.apply(null, vals);
    Object.keys(data.emoji_top_overall).forEach(function(e){
      var c = data.emoji_top_overall[e];
      var wrap=document.createElement('div'); wrap.className='b';
      var em=document.createElement('div'); em.className='e'; em.textContent=e;
      var ct=document.createElement('div'); ct.className='c'; ct.textContent=numFA(c);
      em.style.fontSize = (16 + (c/max)*14) + 'px';
      wrap.appendChild(em); wrap.appendChild(ct); cloud.appendChild(wrap);
    });
  })();

  // --- Detail table ---
  (function(){
    var tb = qs('detailTable').querySelector('tbody');
    function row(name){
      var h = data.head[name];
      var tr = document.createElement('tr');
      tr.innerHTML =
        '<td><b class="badge '+(name==='Masoud'?'b2':'b1')+'">'+name+'</b></td>'+
        '<td>'+numFA(h.messages)+'</td>'+
        '<td>'+h.avg_reply_min+' Ø¯Ù‚ÛŒÙ‚Ù‡</td>'+
        '<td>'+h.median_reply_min+' Ø¯Ù‚ÛŒÙ‚Ù‡</td>'+
        '<td>'+numFA(h.affection)+'</td>'+
        '<td>'+numFA(h.compliment)+'</td>'+
        '<td>'+numFA(h.questions)+'</td>'+
        '<td>'+numFA(h.imperative)+'</td>'+
        '<td>'+numFA(h.short_msgs)+'</td>'+
        '<td>'+numFA(h.joke_meme)+'</td>'+
        '<td>'+h.morning+'</td>'+
        '<td>'+h.night+'</td>'+
        '<td>'+data.affection_index[name]+'</td>'+
        '<td>'+data.emoji_density[name]+'</td>';
      tb.appendChild(tr);
    }
    row("Masoud"); row("Pishul cute <3");
    qs('recDay').textContent = data.record_day.date + ' ('+ numFA(data.record_day.count)+')';
    qs('lastDayM').textContent = data.last_msg_by_day_counts["Masoud"];
    qs('lastDayP').textContent = data.last_msg_by_day_counts["Pishul cute <3"];
    qs('lastNightM').textContent = data.last_msg_at_night_counts["Masoud"];
    qs('lastNightP').textContent = data.last_msg_at_night_counts["Pishul cute <3"];
    qs('firstHour') && (qs('firstHour').textContent = 'â€”'); // (removed in this build)
  })();

  // ---------- SVG CHARTS (no libraries) ----------
  function clear(svg){ while(svg.firstChild) svg.removeChild(svg.firstChild); }
  function mk(tag, attrs){ var e=document.createElementNS('http://www.w3.org/2000/svg', tag); for(var k in attrs) e.setAttribute(k, attrs[k]); return e; }

  // Tornado
  (function(){
    var svg = qs('svgTornado'); clear(svg);
    var labels = ["Ø§Ø¨Ø±Ø§Ø² Ø¹Ù„Ø§Ù‚Ù‡","Ø³Ø¤Ø§Ù„","Ø¯Ø³ØªÙˆØ±ÛŒ","Ù…ÛŒÙ…/Ø´ÙˆØ®ÛŒ"];
    var m = [data.head["Masoud"].affection, data.head["Masoud"].questions, data.head["Masoud"].imperative, data.head["Masoud"].joke_meme];
    var p = [data.head["Pishul cute <3"].affection, data.head["Pishul cute <3"].questions, data.head["Pishul cute <3"].imperative, data.head["Pishul cute <3"].joke_meme];
    var max = Math.max.apply(null, m.concat(p));
    var cx=180, barH=24, gap=20, top=20;
    // axis
    svg.appendChild(mk('line',{x1:cx,y1:10,x2:cx,y2:190,stroke:'#6b7280', 'stroke-width':1}));
    labels.forEach(function(lbl,i){
      var y = top + i*(barH+gap);
      // left (Masoud)
      var wL = (m[i]/max)*150;
      svg.appendChild(mk('rect',{x:cx-wL,y:y,width:wL,height:barH,fill:'var(--acc2)',rx:4,ry:4}));
      // right (Pishul)
      var wR = (p[i]/max)*150;
      svg.appendChild(mk('rect',{x:cx,y:y,width:wR,height:barH,fill:'var(--acc1)',rx:4,ry:4}));
      // label
      var t = mk('text',{x:cx,y:y-4,fill:'#cfd6e6','font-size':'10','text-anchor':'middle'}); t.textContent = lbl; svg.appendChild(t);
      // values
      var tm = mk('text',{x:cx-wL-4,y:y+barH/2+4,fill:'#cfefff','font-size':'10','text-anchor':'end'}); tm.textContent=numFA(m[i]); svg.appendChild(tm);
      var tp = mk('text',{x:cx+wR+4,y:y+barH/2+4,fill:'#ffe3f3','font-size':'10','text-anchor':'start'}); tp.textContent=numFA(p[i]); svg.appendChild(tp);
    });
  })();

  // Donut (initiations)
  (function(){
    var svg = qs('svgDonut'); clear(svg);
    var m = data.sessions.initiations["Masoud"], p = data.sessions.initiations["Pishul cute <3"];
    var total = m+p; if(total===0) total=1;
    var center=100, r=60, stroke=22, circ=2*Math.PI*r;
    function arc(frac, color, offset){
      var len = frac*circ;
      var g = mk('circle',{cx:center,cy:center,r:r,fill:'none','stroke-width':stroke,stroke:color,'stroke-dasharray':len+' '+(circ-len),'stroke-dashoffset':offset});
      svg.appendChild(g);
    }
    // background ring
    svg.appendChild(mk('circle',{cx:center,cy:center,r:r,fill:'none','stroke-width':stroke,stroke:'rgba(255,255,255,.07)'}));
    arc(m/total,'var(--acc2)',0);
    arc(p/total,'var(--acc1)',-(m/total)*circ);
    // labels
    var txt = mk('text',{x:center,y:center+4,fill:'#fff','font-size':'14','text-anchor':'middle','font-weight':'700'});
    txt.textContent = Math.round((m/total)*100) + '% / ' + Math.round((p/total)*100)+'%';
    svg.appendChild(txt);
  })();

  // Reply distribution (grouped bars)
  (function(){
    var svg = qs('svgReply'); clear(svg);
    var cats = ["<1m","1â€“5m","5â€“60m",">60m"];
    var m = cats.map(function(k){return data.reply_distribution["Masoud"][k];});
    var p = cats.map(function(k){return data.reply_distribution["Pishul cute <3"][k];});
    var max = Math.max.apply(null, m.concat(p));
    var left=40, base=170, w=50, gap=40, scale= (120/max);
    // axes
    svg.appendChild(mk('line',{x1:30,y1:base,x2:330,y2:base,stroke:'#6b7280','stroke-width':1}));
    cats.forEach(function(lbl,i){
      var x = left + i*(w*2+gap);
      // Masoud
      var h1 = m[i]*scale; svg.appendChild(mk('rect',{x:x,y:base-h1,width:w,height:h1,fill:'var(--acc2)',rx:4,ry:4}));
      // Pishul
      var h2 = p[i]*scale; svg.appendChild(mk('rect',{x:x+w,y:base-h2,width:w,height:h2,fill:'var(--acc1)',rx:4,ry:4}));
      // label
      var t = mk('text',{x:x+w,y:base+14,fill:'#cfd6e6','font-size':'10','text-anchor':'middle'}); t.textContent = lbl; svg.appendChild(t);
    });
  })();

  // Five metrics per 100 (side-by-side bars)
  (function(){
    var svg = qs('svgFive'); clear(svg);
    var labels = ["Ù…Ø­Ø¨Øª/Û±Û°Û°","Ø§ÛŒÙ…ÙˆØ¬ÛŒ/Û±Û°Û°","Ø³Ø¤Ø§Ù„/Û±Û°Û°","Ø¯Ø³ØªÙˆØ±ÛŒ/Û±Û°Û°","Ú©ÙˆØªØ§Ù‡/Û±Û°Û°"];
    function per100(name,key){ return Math.round((data.head[name][key]/data.head[name].messages)*1000)/10; }
    var m = [data.affection_index["Masoud"], data.emoji_density["Masoud"], per100("Masoud","questions"), per100("Masoud","imperative"), per100("Masoud","short_msgs")];
    var p = [data.affection_index["Pishul cute <3"], data.emoji_density["Pishul cute <3"], per100("Pishul cute <3","questions"), per100("Pishul cute <3","imperative"), per100("Pishul cute <3","short_msgs")];
    var max = Math.max.apply(null, m.concat(p)); if(max<1) max=1;
    var left=80, top=20, barH=16, gap=18, width=240;
    // axis
    svg.appendChild(mk('line',{x1:left,y1:top-10,x2:left+width,y2:top-10,stroke:'rgba(255,255,255,.15)','stroke-width':1}));
    labels.forEach(function(lbl,i){
      var y = top + i*(barH+gap);
      var w1 = (m[i]/max)*width, w2=(p[i]/max)*width;
      svg.appendChild(mk('rect',{x:left,y:y,width:w1,height:barH,fill:'var(--acc2)',rx:4,ry:4}));
      svg.appendChild(mk('rect',{x:left,y:y+barH+4,width:w2,height:barH,fill:'var(--acc1)',rx:4,ry:4}));
      var t = mk('text',{x:10,y:y+barH,'font-size':'11',fill:'#cfd6e6'}); t.textContent=lbl; svg.appendChild(t);
      var v1 = mk('text',{x:left+w1+4,y:y+barH-2,'font-size':'10',fill:'#cfefff'}); v1.textContent=m[i]; svg.appendChild(v1);
      var v2 = mk('text',{x:left+w2+4,y:y+barH+barH+2,'font-size':'10',fill:'#ffe3f3'}); v2.textContent=p[i]; svg.appendChild(v2);
    });
  })();

  // Greet chart (2 cats x 2 people)
  (function(){
    var svg = qs('svgGreet'); clear(svg);
    var cats = ["ØµØ¨Ø­ Ø¨Ø®ÛŒØ±","Ø´Ø¨ Ø¨Ø®ÛŒØ±"];
    var m = [data.head["Masoud"].morning, data.head["Masoud"].night];
    var p = [data.head["Pishul cute <3"].morning, data.head["Pishul cute <3"].night];
    var max = Math.max.apply(null, m.concat(p)); if(max<1) max=1;
    var left=40, base=170, w=50, gap=80, scale=(120/max);
    svg.appendChild(mk('line',{x1:30,y1:base,x2:330,y2:base,stroke:'#6b7280','stroke-width':1}));
    cats.forEach(function(lbl,i){
      var x = left + i*(w*2+gap);
      var h1 = m[i]*scale; svg.appendChild(mk('rect',{x:x,y:base-h1,width:w,height:h1,fill:'var(--acc2)',rx:4,ry:4}));
      var h2 = p[i]*scale; svg.appendChild(mk('rect',{x:x+w,y:base-h2,width:w,height:h2,fill:'var(--acc1)',rx:4,ry:4}));
      var t = mk('text',{x:x+w,y:base+14,fill:'#cfd6e6','font-size':'10','text-anchor':'middle'}); t.textContent = lbl; svg.appendChild(t);
    });
  })();

  // Time chart (typing & online)
  (function(){
    var svg = qs('svgTime'); clear(svg);
    var cats = ["Typing (min)","Online (min)"];
    var m = [data.typing_minutes_by_sender["Masoud"], data.online_minutes_by_sender["Masoud"]];
    var p = [data.typing_minutes_by_sender["Pishul cute <3"], data.online_minutes_by_sender["Pishul cute <3"]];
    var max = Math.max.apply(null, m.concat(p)); if(max<1) max=1;
    var left=50, base=170, w=50, gap=80, scale=(120/max);
    svg.appendChild(mk('line',{x1:30,y1:base,x2:330,y2:base,stroke:'#6b7280','stroke-width':1}));
    cats.forEach(function(lbl,i){
      var x = left + i*(w*2+gap);
      var h1 = m[i]*scale; svg.appendChild(mk('rect',{x:x,y:base-h1,width:w,height:h1,fill:'var(--acc3)',rx:4,ry:4}));
      var h2 = p[i]*scale; svg.appendChild(mk('rect',{x:x+w,y:base-h2,width:w,height:h2,fill:'var(--acc4)',rx:4,ry:4}));
      var t = mk('text',{x:x+w,y:base+14,fill:'#cfd6e6','font-size':'10','text-anchor':'middle'}); t.textContent = lbl; svg.appendChild(t);
    });
  })();

  // --- Global error catcher to show any issue on page ---
  window.addEventListener('error', function(ev){
    var d = qs('dbg'); d.style.display='block';
    d.textContent += 'JS Error: '+ (ev.message||'') + '\n';
  });

})(); // end IIFE
</script>
</body>
</html>
