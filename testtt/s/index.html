<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Masoud â¤ï¸ Pishul â€” Our Chat Story (Jalali)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jalaali-js@1.1.0/dist/jalaali.min.js"></script>
  <style>
    :root{
      --bg:#0d0f14;--bg2:#0f1421;--fg:#e7ebf3;--muted:#a9b1c7;
      --acc1:#ff6bcb;--acc2:#6bd6ff;--acc3:#ffd36b;
      --card:rgba(255,255,255,.06);--glass:rgba(255,255,255,.08);--shadow:0 15px 40px rgba(0,0,0,.35);
      --ok:#47d16c;--warn:#ffbd59;--bad:#ff5d73
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:"Vazirmatn",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(255,107,203,.25), transparent 60%),
        radial-gradient(900px 500px at -10% 90%, rgba(107,214,255,.25), transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg));
      color:var(--fg); overflow-x:hidden;
    }
    header{position:relative;padding:32px 18px 10px;text-align:center}
    .title{font-weight:800;letter-spacing:.4px;font-size:clamp(22px,4.2vw,44px)}
    .sub{opacity:.9;margin-top:6px;font-weight:600;font-size:clamp(12px,2.6vw,16px)}
    .container{max-width:1100px;margin:0 auto;padding:12px 12px 80px}

    .grid{display:grid;gap:14px;grid-template-columns:repeat(12,1fr)}
    .card{grid-column:span 12;background:var(--card);border-radius:16px;padding:14px;box-shadow:var(--shadow)}
    .card-header{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px}
    .card h3{margin:0;font-size:16px}
    .hint{color:var(--muted);font-size:12px}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .kpi{background:var(--glass);border-radius:12px;padding:12px;text-align:center}
    .kpi .num{font-size:22px;font-weight:800}
    .kpi small{display:block;margin-top:4px;color:var(--muted)}

    .span-6{grid-column:span 6}.span-4{grid-column:span 4}.span-8{grid-column:span 8}

    .pills{display:flex;flex-wrap:wrap;gap:8px}
    .pill{padding:8px 12px;border-radius:999px;background:var(--glass);font-size:13px}

    table{width:100%;border-collapse:collapse;border-radius:10px;overflow:hidden}
    th,td{padding:10px;border-bottom:1px dashed rgba(255,255,255,.08)}
    th{text-align:right;color:var(--muted);font-weight:700;font-size:12px}
    tbody tr:hover{background:rgba(255,255,255,.05)}

    .emoji-cloud{display:flex;flex-wrap:wrap;gap:8px}
    .emoji-cloud .b{display:inline-flex;align-items:center;gap:6px;padding:8px 10px;border-radius:10px;background:var(--glass)}
    .emoji-cloud .e{font-size:20px}.emoji-cloud .c{font-size:11px;color:var(--muted)}

    .badge{padding:4px 8px;border-radius:999px;font-size:11px;font-weight:800}
    .b1{background:rgba(255,107,203,.18)} .b2{background:rgba(107,214,255,.18)}

    /* Mobile-first tweaks */
    @media (max-width:900px){
      .span-6,.span-8,.span-4{grid-column:span 12}
      .kpis{grid-template-columns:repeat(2,1fr)}
      .kpi .num{font-size:20px}
      .card{padding:12px}
      .card h3{font-size:15px}
    }
    @media (max-width:560px){
      header{padding:24px 12px 8px}
      .title{font-size:24px}
      .kpis{grid-template-columns:1fr}
      canvas{max-height:260px}
      .emoji-cloud .e{font-size:18px}
      th,td{padding:8px}
    }

    /* Subtle floating hearts for vibe (auto, Ø¨Ø¯ÙˆÙ† Ø¯Ú©Ù…Ù‡) */
    .float-hearts{pointer-events:none;position:fixed;inset:0;overflow:hidden}
    .heart{position:absolute;opacity:.15;animation:rise 12s linear infinite}
    .heart:before{content:"â¤ï¸";font-size:18px;display:block}
    @keyframes rise{from{transform:translateY(100vh) scale(.8)}to{transform:translateY(-10vh) scale(1.2)}}
  </style>
</head>
<body>
  <div class="float-hearts" id="hearts"></div>
  <header>
    <div class="title">Masoud â¤ï¸ Pishul â€” Our Chat Story</div>
    <div class="sub">Ø§Ø² <b id="dr1"></b> ØªØ§ <b id="dr2"></b> â€” <span id="days"></span> Ø±ÙˆØ² Ø¨Ø§ <span id="total"></span> Ù¾ÛŒØ§Ù…</div>
  </header>

  <div class="container">
    <!-- KPIs -->
    <section class="card">
      <div class="card-header"><h3>Ù†Ù…Ø§ÛŒ Ú©Ù„ÛŒ</h3><div class="hint">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†â€ŒÙ‡Ø§ Ø¨Ø§ ÙØ§ØµÙ„Ù‡ Ø³Ø´Ù† â‰¥Û¶Û° Ø¯Ù‚ÛŒÙ‚Ù‡</div></div>
      <div class="kpis">
        <div class="kpi"><div class="num" id="k_total">0</div><small>Ú©Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</small></div>
        <div class="kpi"><div class="num" id="k_sessions">0</div><small>ØªØ¹Ø¯Ø§Ø¯ Ø³Ø´Ù†â€ŒÙ‡Ø§</small></div>
        <div class="kpi"><div class="num" id="k_avgSess">0</div><small>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù…Ø¯Øª Ø³Ø´Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡)</small></div>
        <div class="kpi"><div class="num" id="k_dayAvg">0</div><small>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† Ø±ÙˆØ²Ø§Ù†Ù‡ (Ø¯Ù‚ÛŒÙ‚Ù‡)</small></div>
      </div>
    </section>

    <section class="grid">
      <!-- Tornado chart instead of combo bar -->
      <div class="card span-8">
        <div class="card-header"><h3>Ù†Ù…ÙˆØ¯Ø§Ø± Ù¾Ø±ÙˆØ§Ù†Ù‡â€ŒØ§ÛŒ: Ø¹Ø´Ù‚ / Ø³Ø¤Ø§Ù„ / Ø¯Ø³ØªÙˆØ±ÛŒ / Ù…ÛŒÙ…</h3><div class="hint">Ù…Ù‚Ø§ÛŒØ³Ù‡Ù” Ù…Ø³ØªÙ‚ÛŒÙ… Masoud (Ú†Ù¾) Ùˆ Pishul (Ø±Ø§Ø³Øª)</div></div>
        <canvas id="tornadoChart" height="180"></canvas>
      </div>

      <div class="card span-4">
        <div class="card-header"><h3>Ø´Ø±ÙˆØ¹â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ú¯ÙØªÚ¯Ùˆ</h3><div class="hint">Ø¨Ø¹Ø¯ Ø§Ø² â‰¥Û¶Û° Ø¯Ù‚ÛŒÙ‚Ù‡ Ø³Ú©ÙˆØª</div></div>
        <canvas id="initDonut" height="180"></canvas>
        <div class="hint" style="margin-top:8px">Ø±ÙˆØ² Ø±Ú©ÙˆØ±Ø¯Ø¯Ø§Ø± Ù¾ÛŒØ§Ù…: <b id="recDay"></b></div>
      </div>

      <div class="card span-6">
        <div class="card-header"><h3>ØªÙˆØ²ÛŒØ¹ Ø³Ø±Ø¹Øª Ù¾Ø§Ø³Ø®</h3><div class="hint">Ø³Ø±ÛŒØ¹â€ŒØªØ± = Ø¨Ù‡ØªØ± ğŸ˜‰</div></div>
        <canvas id="replyChart" height="170"></canvas>
      </div>

      <div class="card span-6">
        <div class="card-header"><h3>Radar: Ø§Ø³ØªØ§ÛŒÙ„ Ú¯ÙØªÚ¯Ùˆ (Ø¨Ù‡â€ŒØ§Ø²Ø§ÛŒ Ù‡Ø± Û±Û°Û° Ù¾ÛŒØ§Ù…)</h3><div class="hint">Ù…Ø­Ø¨Øª/Ø§ÛŒÙ…ÙˆØ¬ÛŒ/Ø³Ø¤Ø§Ù„/Ø¯Ø³ØªÙˆØ±ÛŒ/Ú©ÙˆØªØ§Ù‡</div></div>
        <canvas id="radarChart" height="170"></canvas>
      </div>

      <div class="card span-8">
        <div class="card-header"><h3>ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±ØªÚ©Ø±Ø§Ø±</h3><div class="hint">Top 10 Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù†ÙØ± â€” ØªÙ…ÛŒØ² Ùˆ Ù…Ø±ØªØ¨</div></div>
        <div style="display:grid;gap:10px;grid-template-columns:repeat(2,1fr)">
          <div>
            <div class="badge b2" style="margin-bottom:6px">Masoud</div>
            <div class="pills" id="wordsMasoud"></div>
          </div>
          <div>
            <div class="badge b1" style="margin-bottom:6px">Pishul</div>
            <div class="pills" id="wordsPishul"></div>
          </div>
        </div>
      </div>

      <div class="card span-4">
        <div class="card-header"><h3>Ø³Ù„Ø§Ù… Ùˆ Ø´Ø¨â€ŒØ¨Ø®ÛŒØ±</h3><div class="hint">ØµØ¨Ø­/Ø´Ø¨ Ø¨Ù‡ ØªÙÚ©ÛŒÚ©</div></div>
        <canvas id="greetChart" height="180"></canvas>
        <div class="hint" style="margin-top:8px">Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù…Ù Ù‡Ø± Ø±ÙˆØ² â€” Masoud: <b id="lastDayM"></b> | Pishul: <b id="lastDayP"></b></div>
        <div class="hint">Ø´Ø¨â€ŒÙ‡Ø§ (Û²Û²â€“Û°Û³) â€” Masoud: <b id="lastNightM"></b> | Pishul: <b id="lastNightP"></b></div>
      </div>

      <div class="card span-6">
        <div class="card-header"><h3>ØªØ§ÛŒÙ… ØªØ§ÛŒÙ¾ Ùˆ Ø¢Ù†Ù„Ø§ÛŒÙ†</h3><div class="hint">ØªÙ‚Ø±ÛŒØ¨ÛŒ ÙˆÙ„ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ</div></div>
        <canvas id="timeChart" height="170"></canvas>
      </div>

      <div class="card span-6">
        <div class="card-header"><h3>Emoji Cloud</h3><div class="hint">Ù¾Ø±ØªÚ©Ø±Ø§Ø±Ù‡Ø§ÛŒ Ú©Ù„ Ú†Øª</div></div>
        <div id="emojiCloud" class="emoji-cloud"></div>
      </div>

      <div class="card span-12">
        <div class="card-header"><h3>Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ù†ÙØ±</h3><div class="hint">Ø§Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø² Ú†Øª Ø´Ù…Ø§</div></div>
        <div style="overflow:auto">
          <table id="detailTable">
            <thead>
              <tr>
                <th>Ù†ÙØ±</th><th>Ù¾ÛŒØ§Ù…</th><th>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù¾Ø§Ø³Ø®</th><th>Ù…Ø¯ÛŒÙ† Ù¾Ø§Ø³Ø®</th>
                <th>Ø§Ø¨Ø±Ø§Ø² Ø¹Ù„Ø§Ù‚Ù‡</th><th>ØªØ¹Ø±ÛŒÙ/Ú©Ù…Ù¾Ù„ÛŒÙ…Ù†Øª</th><th>Ø³Ø¤Ø§Ù„</th>
                <th>Ø¯Ø³ØªÙˆØ±ÛŒ</th><th>Ú©ÙˆØªØ§Ù‡</th><th>Ù…ÛŒÙ…/Ø´ÙˆØ®ÛŒ</th><th>ØµØ¨Ø­â€ŒØ¨Ø®ÛŒØ±</th><th>Ø´Ø¨â€ŒØ¨Ø®ÛŒØ±</th>
                <th>Ø´Ø§Ø®Øµ Ù…Ø­Ø¨Øª/Û±Û°Û°</th><th>Ú†Ú¯Ø§Ù„ÛŒ Ø§ÛŒÙ…ÙˆØ¬ÛŒ/Û±Û°Û°</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="hint" style="margin-top:8px">
          Ø¨Ø²Ø±Ú¯â€ŒØªØ±ÛŒÙ† ÙØ§ØµÙ„Ù‡ Ø¨ÛŒâ€ŒÙ¾ÛŒØ§Ù…ÛŒ: <b id="gapLen"></b> â€” Ø§Ø² <b id="gapStart"></b> ØªØ§ <b id="gapEnd"></b> | Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø³Ø§Ø¹Øª Ø§ÙˆÙ„ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±ÙˆØ²: <b id="firstHour"></b>
        </div>
      </div>

      <div class="card span-12">
        <div class="card-header"><h3>Ù¾Ø± Ø§Ø­Ø³Ø§Ø³â€ŒØªØ±ÛŒÙ† Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</h3><div class="hint">Ûµ Ù…ÙˆØ±Ø¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù†ÙØ± (ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ Ø´Ù…Ø³ÛŒ)</div></div>
        <div id="emotionalMsgs" style="display:grid;gap:12px;grid-template-columns:repeat(2,1fr)"></div>
      </div>
    </section>
  </div>

  <script>
    // --- Dataset (Ø«Ø§Ø¨Øª Ø´Ø¯Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ­Ù„ÛŒÙ„ ÙØ§ÛŒÙ„ Ø´Ù…Ø§) ---
    const data = {
      participants: ["Masoud","Pishul cute <3"],
      date_range: ["2025-08-11","2025-09-30"],
      total_days: 48, total_messages: 14324,
      sessions:{count:172, avg_session_min:78.8, total_minutes:13548.3, avg_daily_min:282.3, initiations:{"Pishul cute <3":93,"Masoud":79}},
      record_day:{date:"2025-09-23",count:1124},
      last_msg_by_day_counts: {"Pishul cute <3":20,"Masoud":28},
      last_msg_at_night_counts: {"Pishul cute <3":22,"Masoud":24},
      typing_minutes_by_sender: {"Masoud":779.1,"Pishul cute <3":508.1},
      online_minutes_by_sender: {"Masoud":6657.3,"Pishul cute <3":6891.0},
      affection_index: {"Masoud":4.45,"Pishul cute <3":5.47},
      emoji_density: {"Masoud":17.93,"Pishul cute <3":30.88},
      reply_distribution: {
        "Masoud":{"<1m":2238,"1â€“5m":473,"5â€“60m":240,">60m":60},
        "Pishul cute <3":{"<1m":2272,"1â€“5m":472,"5â€“60m":188,">60m":78}
      },
      head:{
        "Masoud":{messages:7105,affection:174,imperative:1078,avg_reply_min:7.2,median_reply_min:0.3,questions:281,short_msgs:2628,morning:10,night:4,compliment:142,joke_meme:712},
        "Pishul cute <3":{messages:7219,affection:246,imperative:938,avg_reply_min:10.3,median_reply_min:0.3,questions:319,short_msgs:3219,morning:8,night:10,compliment:149,joke_meme:1203}
      },
      top_words_by_sender:{
        "Masoud":["Ø¯Ø§Ø±Ù…","Ù…ÛŒ","Ø¨Ø±Ø§","Ø¨Ø§ÛŒØ¯","Ú©Ù†","Ø®ÙˆØ¨","Ù…ÛŒÚ©Ù†Ù…","Ú©Ø±Ø¯Ù…","Ú©Ø§Ø±","ÙÚ©"],
        "Pishul cute <3":["Ø®ÙˆØ¨","Ø¯Ø§Ø±Ù…","Ø§Ø±Ù‡","Ù†ÛŒØ³Øª","Ù…Ù†Ù…","Ø¨ÙˆØ³","Ø¯ÙˆØ³Øª","Ø¨Ø§ÛŒØ¯","ÙÚ©Ø±","Ú©Ù†"]
      },
      emoji_top_overall: {"ğŸ˜‚":663,"ğŸ˜":165,"ğŸ˜¡":148,"ğŸ˜½":119,"ğŸ—£":111,"ğŸ˜­":79,"ğŸ¥¹":70,"ğŸ˜":65,"â¤":49,"â˜¹ï¸":46,"ğŸ§":40},
      top_emojis_by_sender: {
        "Masoud":{"ğŸ˜":165,"ğŸ˜‚":129,"ğŸ’‹":29,"ğŸ«¡":25,"â¤":19,"ğŸ˜":13,"âœ¨":8,"ğŸ˜":7,"ğŸ‘":6,"ğŸ™":6,"â¤ï¸":5},
        "Pishul cute <3":{"ğŸ˜‚":534,"ğŸ˜¡":148,"ğŸ˜½":119,"ğŸ—£":111,"ğŸ˜­":76,"ğŸ¥¹":70,"ğŸ˜":58,"â˜¹ï¸":45,"ğŸ§":40,"â¤":30,"ğŸ™":14}
      },
      longest_gap:{length:"3 days 07:44:53",start:"2025-08-23 09:58:59",end:"2025-08-26 17:43:52"},
      avg_first_hour:2.15,
      emotional_top5:{
        "Masoud":[
          {"score":12.03,"dt":"2025-09-21 21:25:23","text":"â¤ï¸â¤ï¸â¤ï¸"},
          {"score":12.03,"dt":"2025-09-30 01:03:01","text":"â¤ï¸â¤ï¸â¤ï¸"},
          {"score":8.05,"dt":"2025-09-26 02:39:44","text":"â¤ï¸ Ø¨ÙˆØ³ Ø¨Ù‡Øª"},
          {"score":8.04,"dt":"2025-09-27 02:54:08","text":"ÙØ¹Ù„Ø§â¤ï¸â¤ï¸"},
          {"score":8.03,"dt":"2025-09-23 18:48:07","text":"âœ…â¤ï¸â¤ï¸"}
        ],
        "Pishul cute <3":[
          {"score":36.09,"dt":"2025-09-15 02:30:15","text":"â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸"},
          {"score":15.03,"dt":"2025-08-12 04:06:43","text":"ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­"},
          {"score":12.28,"dt":"2025-09-24 18:40:24","text":"Im literally gonna die ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­ Youâ€™re too cutelaoaoqoqoqoqq"},
          {"score":12.13,"dt":"2025-09-28 20:01:17","text":"True love still exists ğŸ¥¹ğŸ¥¹ğŸ¥¹ğŸ¥¹"},
          {"score":12.03,"dt":"2025-09-24 15:24:22","text":"â¤ï¸â¤ï¸â¤ï¸"}
        ]
      }
    };

    // --- Helpers: Persian/Jalali ---
    const pad = n => String(n).padStart(2,'0');
    function g2jStr(isoDate){ // "YYYY-MM-DD" or "YYYY-MM-DD HH:mm:ss"
      const withT = isoDate.includes('T')? isoDate : isoDate.replace(' ','T');
      const d = new Date(withT);
      const j = jalaali.toJalaali(d.getFullYear(), d.getMonth()+1, d.getDate());
      const date = `${j.jy}-${pad(j.jm)}-${pad(j.jd)}`;
      const time = `${pad(d.getHours())}:${pad(d.getMinutes())}`;
      return isoDate.length>10 ? `${date} ${time}` : date;
    }

    // --- Floating hearts (auto) ---
    const hearts = document.getElementById('hearts');
    (function sprinkle(){
      hearts.innerHTML=''; const N=20;
      for(let i=0;i<N;i++){
        const h=document.createElement('div'); h.className='heart';
        h.style.left=Math.random()*100+'%';
        h.style.animationDelay=(Math.random()*-12)+'s';
        hearts.appendChild(h);
      }
    })();

    // --- Header numbers (with Jalali dates) ---
    const [d1,d2]=data.date_range;
    document.getElementById('dr1').textContent = g2jStr(d1);
    document.getElementById('dr2').textContent = g2jStr(d2);
    document.getElementById('days').textContent = data.total_days.toLocaleString('fa-IR');
    document.getElementById('total').textContent = data.total_messages.toLocaleString('fa-IR');

    const animTo=(el,val)=>{const dur=900,t0=performance.now();const tick=t=>{const p=Math.min(1,(t-t0)/dur);el.textContent=Math.floor(val*p).toLocaleString('fa-IR'); if(p<1) requestAnimationFrame(tick);}; requestAnimationFrame(tick);};
    animTo(document.getElementById('k_total'), data.total_messages);
    animTo(document.getElementById('k_sessions'), data.sessions.count);
    animTo(document.getElementById('k_avgSess'), Math.round(data.sessions.avg_session_min));
    animTo(document.getElementById('k_dayAvg'), Math.round(data.sessions.avg_daily_min));

    // Record day (Jalali)
    document.getElementById('recDay').textContent = `${g2jStr(data.record_day.date)} (${data.record_day.count.toLocaleString('fa-IR')})`;

    // Last message counts
    document.getElementById('lastDayM').textContent = data.last_msg_by_day_counts["Masoud"];
    document.getElementById('lastDayP').textContent = data.last_msg_by_day_counts["Pishul cute <3"];
    document.getElementById('lastNightM').textContent = data.last_msg_at_night_counts["Masoud"];
    document.getElementById('lastNightP').textContent = data.last_msg_at_night_counts["Pishul cute <3"];

    // Gap & first-hour (Jalali)
    document.getElementById('gapLen').textContent = data.longest_gap.length;
    document.getElementById('gapStart').textContent = g2jStr(data.longest_gap.start);
    document.getElementById('gapEnd').textContent = g2jStr(data.longest_gap.end);
    const fh = data.avg_first_hour; // hours float
    document.getElementById('firstHour').textContent = `${pad(Math.floor(fh))}:${pad(Math.round((fh%1)*60))}`;

    // Top words
    const wM = document.getElementById('wordsMasoud');
    const wP = document.getElementById('wordsPishul');
    data.top_words_by_sender["Masoud"].forEach(w=>{ const el=document.createElement('div'); el.className='pill'; el.textContent=w; wM.appendChild(el); });
    data.top_words_by_sender["Pishul cute <3"].forEach(w=>{ const el=document.createElement('div'); el.className='pill'; el.textContent=w; wP.appendChild(el); });

    // Emoji cloud
    const cloud = document.getElementById('emojiCloud');
    const maxEmoji = Math.max(...Object.values(data.emoji_top_overall));
    Object.entries(data.emoji_top_overall).forEach(([e,c])=>{
      const wrap=document.createElement('div'); wrap.className='b';
      const em=document.createElement('div'); em.className='e'; em.textContent=e;
      const ct=document.createElement('div'); ct.className='c'; ct.textContent=c.toLocaleString('fa-IR');
      em.style.fontSize = (16 + (c/maxEmoji)*16)+'px';
      wrap.appendChild(em); wrap.appendChild(ct); cloud.appendChild(wrap);
    });

    // Detail table
    const tbody=document.querySelector('#detailTable tbody');
    function rowFor(name){
      const h=data.head[name];
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td><b class="badge ${name==='Masoud'?'b2':'b1'}">${name}</b></td>
        <td>${h.messages.toLocaleString('fa-IR')}</td>
        <td>${h.avg_reply_min} Ø¯Ù‚ÛŒÙ‚Ù‡</td>
        <td>${h.median_reply_min} Ø¯Ù‚ÛŒÙ‚Ù‡</td>
        <td>${h.affection.toLocaleString('fa-IR')}</td>
        <td>${h.compliment.toLocaleString('fa-IR')}</td>
        <td>${h.questions.toLocaleString('fa-IR')}</td>
        <td>${h.imperative.toLocaleString('fa-IR')}</td>
        <td>${h.short_msgs.toLocaleString('fa-IR')}</td>
        <td>${h.joke_meme.toLocaleString('fa-IR')}</td>
        <td>${h.morning}</td>
        <td>${h.night}</td>
        <td>${data.affection_index[name]}</td>
        <td>${data.emoji_density[name]}</td>`;
      tbody.appendChild(tr);
    }
    rowFor("Masoud"); rowFor("Pishul cute <3");

    // Emotional top-5 (with Jalali dates)
    const emo = document.getElementById('emotionalMsgs');
    function emoBlock(name, arr){
      const box=document.createElement('div');
      box.innerHTML = `<div class="badge ${name==='Masoud'?'b2':'b1'}" style="margin-bottom:6px">${name}</div>`;
      arr.forEach((o,i)=>{
        const row=document.createElement('div');
        row.style.cssText='background:var(--glass);padding:10px;border-radius:12px;margin-bottom:8px';
        row.innerHTML = `<div class="hint">${i+1}. ${g2jStr(o.dt)} â€” Ø§Ù…ØªÛŒØ§Ø² Ø§Ø­Ø³Ø§Ø³: ${o.score}</div><div style="margin-top:6px">${o.text}</div>`;
        box.appendChild(row);
      });
      emo.appendChild(box);
    }
    emoBlock("Masoud", data.emotional_top5["Masoud"]);
    emoBlock("Pishul cute <3", data.emotional_top5["Pishul cute <3"]);

    // ----- Charts -----
    const COLORS={m:{a:"#6bd6ff",b:"#3fa9d8"}, p:{a:"#ff6bcb",b:"#e84da9"}, y:"#ffd36b", g:"#47d16c", v:"#b387ff"};

    // Tornado (butterfly) chart
    const tCtx=document.getElementById('tornadoChart');
    const labels=["Ø§Ø¨Ø±Ø§Ø² Ø¹Ù„Ø§Ù‚Ù‡","Ø³Ø¤Ø§Ù„","Ø¯Ø³ØªÙˆØ±ÛŒ","Ù…ÛŒÙ…/Ø´ÙˆØ®ÛŒ"];
    const mVals=[data.head["Masoud"].affection, data.head["Masoud"].questions, data.head["Masoud"].imperative, data.head["Masoud"].joke_meme];
    const pVals=[data.head["Pishul cute <3"].affection, data.head["Pishul cute <3"].questions, data.head["Pishul cute <3"].imperative, data.head["Pishul cute <3"].joke_meme];
    new Chart(tCtx,{
      type:'bar',
      data:{
        labels,
        datasets:[
          {label:'Masoud', data:mVals.map(v=>-v), backgroundColor:COLORS.m.a},
          {label:'Pishul', data:pVals, backgroundColor:COLORS.p.a}
        ]
      },
      options:{
        indexAxis:'y',
        responsive:true,
        plugins:{
          legend:{position:'bottom'},
          tooltip:{callbacks:{label:(ctx)=>`${ctx.dataset.label}: ${Math.abs(ctx.raw).toLocaleString('fa-IR')}`}}
        },
        scales:{
          x:{
            ticks:{callback:(v)=>Math.abs(v).toLocaleString('fa-IR')},
            grid:{color:'rgba(255,255,255,.1)'}
          },
          y:{grid:{color:'rgba(255,255,255,.08)'}}
        }
      }
    });

    // Reply distribution
    const repCtx=document.getElementById('replyChart');
    const repLabels=["<1m","1â€“5m","5â€“60m",">60m"];
    const repMasoud=repLabels.map(k=>data.reply_distribution["Masoud"][k]);
    const repPishul=repLabels.map(k=>data.reply_distribution["Pishul cute <3"][k]);
    new Chart(repCtx,{type:'bar',data:{labels:repLabels,datasets:[
      {label:"Masoud",data:repMasoud,backgroundColor:COLORS.m.a},
      {label:"Pishul",data:repPishul,backgroundColor:COLORS.p.a}
    ]},options:{plugins:{legend:{position:'bottom'}},scales:{y:{ticks:{callback:(v)=>v.toLocaleString('fa-IR')}}}}});

    // Radar per 100
    function per100(name,key){ return Math.round((data.head[name][key]/data.head[name].messages)*1000)/10 }
    const rCtx=document.getElementById('radarChart');
    new Chart(rCtx,{type:'radar',data:{
      labels:["Ø´Ø§Ø®Øµ Ù…Ø­Ø¨Øª","Ú†Ú¯Ø§Ù„ÛŒ Ø§ÛŒÙ…ÙˆØ¬ÛŒ/Ù…ÛŒÙ…","Ø³Ø¤Ø§Ù„/Û±Û°Û°","Ø¯Ø³ØªÙˆØ±ÛŒ/Û±Û°Û°","Ú©ÙˆØªØ§Ù‡/Û±Û°Û°"],
      datasets:[
        {label:"Masoud", data:[data.affection_index["Masoud"], data.emoji_density["Masoud"], per100("Masoud","questions"), per100("Masoud","imperative"), per100("Masoud","short_msgs")],
         backgroundColor:"rgba(107,214,255,.22)", borderColor:COLORS.m.a, pointBackgroundColor:COLORS.m.b},
        {label:"Pishul", data:[data.affection_index["Pishul cute <3"], data.emoji_density["Pishul cute <3"], per100("Pishul cute <3","questions"), per100("Pishul cute <3","imperative"), per100("Pishul cute <3","short_msgs")],
         backgroundColor:"rgba(255,107,203,.22)", borderColor:COLORS.p.a, pointBackgroundColor:COLORS.p.b}
      ]
    },options:{plugins:{legend:{position:'bottom'}},scales:{r:{angleLines:{color:"rgba(255,255,255,.15)"}}}});

    // Initiations donut
    const iCtx=document.getElementById('initDonut');
    new Chart(iCtx,{type:'doughnut',data:{
      labels:["Masoud","Pishul"],
      datasets:[{data:[data.sessions.initiations["Masoud"],data.sessions.initiations["Pishul cute <3"]], backgroundColor:[COLORS.m.a,COLORS.p.a]}]
    },options:{plugins:{legend:{position:'bottom'}},cutout:'55%'}});

    // Time chart
    const t2=document.getElementById('timeChart');
    new Chart(t2,{type:'bar',data:{
      labels:["Masoud","Pishul"],
      datasets:[
        {label:"Typing (min)",data:[data.typing_minutes_by_sender["Masoud"],data.typing_minutes_by_sender["Pishul cute <3"]],backgroundColor:"#ffd36b"},
        {label:"Online (min)",data:[data.online_minutes_by_sender["Masoud"],data.online_minutes_by_sender["Pishul cute <3"]],backgroundColor:"#47d16c"}
      ]
    },options:{plugins:{legend:{position:'bottom'}},scales:{y:{ticks:{callback:(v)=>v.toLocaleString('fa-IR')}}}}});
  </script>
</body>
</html>
